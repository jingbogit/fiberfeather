!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three"),require("axios")):"function"==typeof define&&define.amd?define([,"axios"],t):"object"==typeof exports?exports.engine=t(require("three"),require("axios")):e.engine=t(e.THREE,e.axios)}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=67)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"degreeToRadian",value:function(e){return e*(Math.PI/180)}},{key:"radianToDegree",value:function(e){return e*(180/Math.PI)}},{key:"webMercatorXToRadianLog",value:function(t){return t/e.EARTH_RADIUS}},{key:"webMercatorXToDegreeLog",value:function(t){var r=e.webMercatorXToRadianLog(t);return e.radianToDegree(r)}},{key:"webMercatorYToRadianLat",value:function(t){if(isNaN(t))throw{error:"webMercatorYToRadianLat",detail:t};var r=t/e.EARTH_RADIUS,n=Math.pow(Math.E,r);return 2*Math.atan(n)-Math.PI/2}},{key:"webMercatorYToDegreeLat",value:function(e){var t=this.webMercatorYToRadianLat(e);return this.radianToDegree(t)}},{key:"getTileWebMercatorEnvelopeByGrid",value:function(t,r,n){var o=e.EQUATOR/2,i=2*o/Math.pow(2,t),a=r*i-o,s=o-n*i;return{minX:a,minY:s-i,maxX:a+i,maxY:s}}},{key:"getWebMercatorGrid",value:function(e){}},{key:"webMercatorToDegreeGeographic",value:function(t,r){return[e.webMercatorXToDegreeLog(t),e.webMercatorYToDegreeLat(r)]}},{key:"getTileGeographicEnvelopByGrid",value:function(t,r,n){var o=e.getTileWebMercatorEnvelopeByGrid(t,r,n),i=e.webMercatorToDegreeGeographic(o.minX,o.minY),a=e.webMercatorToDegreeGeographic(o.maxX,o.maxY);return{minLon:i[0],minLat:i[1],maxLon:a[0],maxLat:a[1]}}},{key:"geographicToCartesianCoord",value:function(t,r,n){if(!(t>=-180.001&&t<=180.001)){console.warn(t);throw{error:"invalid lon",detail:"geographicToCartesianCoord"}}if(!(r>=-90.001&&r<=90.001)){console.warn(r);throw{error:"invalid lat",detail:"geographicToCartesianCoord"}}var o=e.degreeToRadian(t),i=e.degreeToRadian(r),a=Math.sin(o),s=Math.cos(o),l=Math.sin(i),u=Math.cos(i);return{x:n*a*u,y:n*l,z:n*s*u}}},{key:"geographicToEarthSurface",value:function(t,r,n,i){new o.Vector3;var a=e.getTileGridByGeographic(t,r,n),s=a.column,l=a.row;var u=e.getTileCartesianEnvelopByGrid(t,s,l,i),c=e.getTileGeographicEnvelopByGrid(t,s,l),h=u,f=c.maxLon-c.minLon,d=c.maxLat-c.minLat,p=r-c.minLon,v=c.maxLon-r,y=c.maxLat-n,m=n-c.minLat,g=h[2].clone().multiplyScalar(v/f).add(h[1].clone().multiplyScalar(p/f)),A=h[3].clone().multiplyScalar(v/f).add(h[0].clone().multiplyScalar(p/f));return g.multiplyScalar(m/d).add(A.multiplyScalar(y/d))}},{key:"geographicToEarthSurfaceByIntersection",value:function(t,r,n,i){var a=e.getTileGridByGeographic(t,r,n),s=a.column,l=a.row,u=e.getTileCartesianEnvelopByGrid(t,s,l,i);var c=u[0].clone(),h=u[1].clone(),f=u[2].clone(),d=c.clone().sub(h),p=f.clone().sub(h);var v=p.clone().cross(d).normalize();var y=-c.clone().sub(new o.Vector3(0,0,0)).dot(v);var m=new o.Plane(v,y),g=e.geographicToCartesianCoord(r,n,1.1*i),A=new o.Line3(new o.Vector3(0,0,0),g),_=new o.Vector3;return m.intersectLine(A,_),_}},{key:"getGeoNormalOnEarthSurface",value:function(t,r,n){var i=e.getTileGridByGeographic(t,r,n),a=i.column,s=i.row,l=e.getTileGeographicEnvelopByGrid(t,a,s);var u={lat:(l.minLat+l.maxLat)/2,lon:(l.minLon+l.maxLon)/2};var c=e.geographicToCartesianCoord(u.lon,u.lat,1);return(c=new o.Vector3(c.x,c.y,c.z)).normalize(),c}},{key:"getLocalSystemOnEarthSurface",value:function(t,r,n,i){var a=e.getTileGridByGeographic(t,r,n),s=a.column,l=a.row,u=e.getTileGeographicEnvelopByGrid(t,s,l);u.minLon,u.minLat,u.maxLon,u.maxLat;var c=e.getTileCartesianEnvelopByGrid(t,s,l,i);var h=c[0].clone(),f=c[1].clone(),d=c[2].clone(),p=h.clone().sub(f),v=d.clone().sub(f);var y=v.clone().cross(p).normalize();var m=-h.clone().sub(new o.Vector3(0,0,0)).dot(y);var g=new o.Plane(y,m),A=e.geographicToCartesianCoord(r,n,1.1*i),_=new o.Line3(new o.Vector3(0,0,0),A),b=new o.Vector3;g.intersectLine(_,b);var w=f.clone().sub(d).normalize(),x=y.clone().cross(w).normalize();y.clone().cross(w).normalize();return{origin:e.geographicToEarthSurface(t,r,n,i),lng:w,lat:x,alt:y}}},{key:"getTileCartesianEnvelopByGrid",value:function(t,r,n,i){var a=e.getTileGeographicEnvelopByGrid(t,r,n),s=[];s[3]=e.geographicToCartesianCoord(a.minLon,a.minLat,i),s[2]=e.geographicToCartesianCoord(a.minLon,a.maxLat,i),s[1]=e.geographicToCartesianCoord(a.maxLon,a.maxLat,i),s[0]=e.geographicToCartesianCoord(a.maxLon,a.minLat,i);for(var l=0;l<4;l++)s[l]=new o.Vector3(s[l].x,s[l].y,s[l].z);return s}},{key:"getTileCartesianEnvelopOnEarthSurface",value:function(t,r,n,i,a){var s=e.getTileGeographicEnvelopByGrid(t,r,n),l=[];l[3]=e.geographicToEarthSurface(a,s.minLon,s.minLat,i),l[2]=e.geographicToEarthSurface(a,s.minLon,s.maxLat,i),l[1]=e.geographicToEarthSurface(a,s.maxLon,s.maxLat,i),l[0]=e.geographicToEarthSurface(a,s.maxLon,s.minLat,i);for(var u=0;u<4;u++)l[u]=new o.Vector3(l[u].x,l[u].y,l[u].z),l[u].length()>1.5&&console.warn(arguments,s,l[u]);return l}},{key:"getTileCartesianGeometryOnEarthSurface",value:function(t,r,n,i,a,s){for(var l=e.getTileWebMercatorEnvelopeByGrid(t,r,n),u=[],c=[],h=[],f=[],d=(l.maxX-l.minX)/a,p=(l.maxY-l.minY)/a,v=1/a,y=[],m=[],g=[],A=[],_=0;_<=a;_++){y.push(l.minX+_*d),m.push(l.minY+_*p);var b=_*v;g.push(b),A.push(b)}for(var w=0;w<=a;w++)for(var x=0;x<=a;x++){var O=y[x],S=m[w],k=e.webMercatorToDegreeGeographic(O,S),E=e.geographicToEarthSurface(s,k[0],k[1],i);u.push(new o.Vector3(E.x,E.y,E.z)),h.push(new o.Vector2(g[x],A[w]))}for(var T=0;T<a;T++)for(var P=0;P<a;P++){var M=(a+1)*T+P,C=(a+1)*(T+1)+P,R=C+1,L=M+1,j=new o.Face3(R,C,M),N=new o.Face3(M,L,R);c.push(j,N),f.push([h[R],h[C],h[M]],[h[M],h[L],h[R]])}f.length!==c.length&&console.warn("unequal uvs and vertices");var I=new o.Geometry;return I.vertices=u,I.faces=c,I.faceVertexUvs[0]=f,(new o.BufferGeometry).fromGeometry(I)}},{key:"getTileCartesianGeometryByGrid",value:function(t,r,n,i,a){if(!function(){isNaN(a)&&(console.warn("segment not a number",a),a=1);(a=Math.floor(a))<=0||a>999?(console.warn("segment out of range",a,"level",t),a=1):a<1&&(a=1);return!0}())return console.error("getTileCartesianGeometryByGrid has error that cannot proceed"),null;for(var s=e.getTileWebMercatorEnvelopeByGrid(t,r,n),l=[],u=[],c=[],h=[],f=(s.maxX-s.minX)/a,d=(s.maxY-s.minY)/a,p=1/a,v=[],y=[],m=[],g=[],A=0;A<=a;A++){v.push(s.minX+A*f),y.push(s.minY+A*d);var _=A*p;m.push(_),g.push(_)}for(var b=0;b<=a;b++)for(var w=0;w<=a;w++){var x=v[w],O=y[b],S=e.webMercatorToDegreeGeographic(x,O),k=e.geographicToCartesianCoord(S[0],S[1],i);l.push(new o.Vector3(k.x,k.y,k.z)),c.push(new o.Vector2(m[w],g[b]))}for(var E=0;E<a;E++)for(var T=0;T<a;T++){var P=(a+1)*E+T,M=(a+1)*(E+1)+T,C=M+1,R=P+1,L=new o.Face3(C,M,P),j=new o.Face3(P,R,C);u.push(L,j),h.push([c[C],c[M],c[P]],[c[P],c[R],c[C]])}h.length!==u.length&&console.warn("unequal uvs and vertices");var N=new o.Geometry;return N.vertices=l,N.faces=u,N.faceVertexUvs[0]=h,(new o.BufferGeometry).fromGeometry(N)}},{key:"radianLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=Math.PI+.001&&t>=-(Math.PI+.001))){throw{detail:"invalid radianLog"}}return e.EARTH_RADIUS*t}},{key:"degreeLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=180.001&&t>=-180.001)){throw{detail:"invalid degreeLog"}}var r=e.degreeToRadian(t);return e.radianLogToWebMercatorX(r)}},{key:"radianLatToWebMercatorY",value:function(t){if(!(t<=Math.PI/2+.001&&t>=-(Math.PI/2+.001))){throw{detail:"invalid radianLat"}}var r=Math.PI/4+t/2,n=Math.tan(r),o=Math.log(n);return e.EARTH_RADIUS*o}},{key:"degreeLatToWebMercatorY",value:function(t){if(!(t<=90.001&&t>=-90.001)){throw{detail:"invalid degreeLat"}}var r=e.degreeToRadian(t);return e.radianLatToWebMercatorY(r)}},{key:"radianGeographicToWebMercator",value:function(t,r){return[e.radianLogToWebMercatorX(t),e.radianLatToWebMercatorY(r)]}},{key:"degreeGeographicToWebMercator",value:function(t,r){return[e.degreeLogToWebMercatorX(t),e.degreeLatToWebMercatorY(r)]}},{key:"numerationSystemTo10",value:function(e,t){return parseInt(t,e)}},{key:"numerationSystemFrom10",value:function(e,t){return t.toString(e)}},{key:"numerationSystemChange",value:function(t,r,n){var o=e.numerationSystemTo10(t,n);return e.numerationSystemFrom10(r,o)}},{key:"utmToWgs84",value:function(e,t,r){var n=r.split("_");if(2!==n.length)return{};var o=Number(n[0]),i=/[n-z]/i.test(n[1]);!1===i&&(t=1e7-t);var a=6378137,s=.081819191,l=.006739497,u=t/.9996/(a*(1-Math.pow(s,2)/4-3*Math.pow(s,4)/64-5*Math.pow(s,6)/256)),c=(1-Math.sqrt(1-s*s))/(1+Math.sqrt(1-s*s)),h=3*c/2-27*Math.pow(c,3)/32,f=21*Math.pow(c,2)/16-55*Math.pow(c,4)/32,d=151*Math.pow(c,3)/96,p=1097*Math.pow(c,4)/512,v=u+h*Math.sin(2*u)+f*Math.sin(4*u)+d*Math.sin(6*u)+p*Math.sin(8*u),y=a/Math.pow(1-Math.pow(s*Math.sin(v),2),.5),m=a*(1-s*s)/Math.pow(1-Math.pow(s*Math.sin(v),2),1.5),g=y*Math.tan(v)/m,A=5e5-e,_=A/(.9996*y),b=_*_/2,w=Math.pow(Math.tan(v),2),x=l*Math.pow(Math.cos(v),2),O=(5+3*w+10*x-4*x*x-9*l)*Math.pow(_,4)/24,S=(61+90*w+298*x+45*w*w-252*l-3*x*x)*Math.pow(_,6)/720,k=180*((A/(.9996*y)-(1+2*w+x)*Math.pow(_,3)/6+(5-2*x+28*w-3*Math.pow(x,2)+8*l+24*Math.pow(w,2))*Math.pow(_,5)/120)/Math.cos(v))/Math.PI,E=180*(v-g*(b+O+S))/Math.PI;return!1===i&&(E=-E),{latitude:E,longitude:o>0?6*o-183-k:3-k}}},{key:"sphericalToGeographic",value:function(t,r){var n=r,o=Math.PI/2-t;return[e.radianToDegree(n),e.radianToDegree(o)]}},{key:"earthSurfaceToGeographic",value:function(t,r,n){var i=!1;i&&console.log("target",r);var a=new o.Spherical;a.setFromVector3(r);var s=e.sphericalToGeographic(a.phi,a.theta),l=e.getTileGridByGeographic(t,s[0],s[1]),u=e.getTileCartesianEnvelopByGrid(t,l.column,l.row,n);i&&console.log("cart",u);var c=u[1].clone().sub(u[2]),h=u[0].clone().sub(u[3]),f=A(r,u[2],c),d=A(r,u[3],h);i&&console.log("dist",f,d);var p=f+d;f/=p,d/=p,i&&console.log("b1",f,"b2",d,"bsum",p);var v=new o.Vector3;v.lerpVectors(u[2],u[3],f);var y=new o.Vector3;y.lerpVectors(u[1],u[0],f);var m=r.distanceTo(v)/y.distanceTo(v);i&&console.log("a1",m);var g=e.getTileGeographicEnvelopByGrid(t,l.column,l.row,n);return{lng:g.minLon+(g.maxLon-g.minLon)*m,lat:g.minLat+(g.maxLat-g.minLat)*(1-f)};function A(e,t,r){t=t.clone(),r=r.clone().normalize(),e=e.clone(),i&&console.log("distanceTo",t,r,e);var n=t.clone().add(r.multiplyScalar(e.clone().sub(t).dot(r)));return i&&console.log("proj",n),n.distanceTo(e)}}},{key:"getNoneGroundCartesianFromLngLatAlt",value:function(t,r,n,i,a){new o.Vector3;var s=e.getTileGridByGeographic(t,r,n),l=s.column,u=s.row,c=e.getTileCartesianEnvelopByGrid(t,l,u,a),h=c[0].clone(),f=c[1].clone(),d=c[2].clone(),p=h.clone().sub(f),v=d.clone().sub(f).clone().cross(p).normalize();var y=e.getTileGeographicEnvelopByGrid(t,l,u),m=c,g=y.maxLon-y.minLon,A=y.maxLat-y.minLat,_=r-y.minLon,b=y.maxLon-r,w=y.maxLat-n,x=n-y.minLat,O=m[2].clone().multiplyScalar(b/g).add(m[1].clone().multiplyScalar(_/g)),S=m[3].clone().multiplyScalar(b/g).add(m[0].clone().multiplyScalar(_/g)),k=O.multiplyScalar(x/A).add(S.multiplyScalar(w/A)).clone().add(v.multiplyScalar(i*a/e.EARTH_RADIUS));return k}},{key:"getLngLatAltFromNoneGroundCartesian",value:function(t,r,n){var o=e.projectCartesianOntoEarthSurface(t,r.clone(),n),i=e.earthSurfaceToGeographic(t,o.clone(),n),a=r.clone().sub(o).length()*(r.length()>o.length()?1:-1)/n*e.EARTH_RADIUS;return{lng:i.lng,lat:i.lat,alt:a}}},{key:"projectCartesianOntoEarthSurface",value:function(t,r,n){var i=new o.Spherical;i.setFromVector3(r);var a=e.sphericalToGeographic(i.phi,i.theta),s=e.getTileGridByGeographic(t,a[0],a[1]),l=e.getTileCartesianEnvelopByGrid(t,s.column,s.row,n),u=l[0].clone(),c=l[1].clone(),h=l[2].clone(),f=u.clone().sub(c),d=h.clone().sub(c).clone().cross(f).normalize();return u.clone().sub(r).projectOnVector(d).add(r)}},{key:"getTileGridByGeographic",value:function(t,r,n){var o=e.degreeGeographicToWebMercator(r,n),i=e.EQUATOR/Math.pow(2,t),a=e.EQUATOR/2;return{column:Math.floor((o[0]+a)/i),row:Math.floor((a-o[1])/i)}}},{key:"EQUATOR",get:function(){return 40075016.686}},{key:"EARTH_RADIUS",get:function(){return 6378137}}]),e}();t.default=i},function(e,t,r){var n;e.exports=(n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],o=function(t){var t=t,r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=o(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,s=4*i,l=o/s,u=(l=t?e.ceil(l):e.max((0|l)-this._minBufferSize,0))*i,c=e.min(4*u,o);if(u){for(var h=0;h<u;h+=i)this._doProcessBlock(n,h);var f=n.splice(0,u);r.sigBytes-=c}return new a.init(f,c)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(o.Hasher=h.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.delayPromise=function(e){return function(t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})}},t.timedPromise=function(e,t){var r=new Promise(function(e,r){var n=setTimeout(function(){clearTimeout(n),r(new Error("Timed out in "+t+"ms."))},t)});return Promise.race([e,r])},t.throttle=function(e,t){var r=void 0,n=void 0,o=void 0;return function(){var i=this,a=arguments;r?(clearTimeout(n),n=setTimeout(function(){Date.now()-o>=t&&(e.apply(i,a),o=Date.now())},t-(Date.now()-o))):(e.apply(i,a),o=Date.now(),r=!0)}},t.debounce=function(e,t){var r=void 0;return function(){var n=this,o=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,o)},t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t,this._node=new o.Object3D,this._node.matrixAutoUpdate=!1,this._children=[],null!==t&&t.addChild(this),this.visible=!0,this._property={type:"HyperNode"}}return n(e,[{key:"destruct",value:function(){this._property.type="destructed";var e=!0;if(this.children&&this.children.length>0)for(var t=this.children.length-1;t>=0;t--)e=e&&this.children[t].destruct();return this._children=[],this.parent&&(e=e&&this.parent.removeChild(this)),this._parent=null,this._node=void 0,e||console.warn("HyperNode destruct failure."),e}},{key:"addChild",value:function(e){return-1!==this._children.indexOf(e)?(console.warn("Trying to add an exisitng child."),!1):(this._children.push(e),this._node.add(e.sceneNode),!0)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return-1===t?(console.warn("Trying to remove an un-exisitng child."),!1):(this._children.splice(t,1),this._node.remove(e.sceneNode),!0)}},{key:"applyToChildren",value:function(e,t,r,n){for(var o=!0,i=0;i<this._children.length;i++)o=e(this._children[i],t,r,n)&&o;return o}},{key:"traverse",value:function(e){var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseVisible",value:function(e){if(!1===this.visible)return!0;var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseAncestors",value:function(e){var t=this.parent,r=!0;return null!==t&&(r=e(t)&&r,r=t.traverseAncestors(e)&&r),r}},{key:"setMatrix",value:function(e,t){this.sceneNode.matrix.copy(e),this.sceneNode.matrixWorldNeedsUpdate=!0}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"updateVisibility",value:function(e){this.applyToChildren(function(e,t){e.updateVisibility(t)},e)}},{key:"animate",value:function(e){this.applyToChildren(function(e,t){e.animate(t)},e)}},{key:"initInfo",value:function(){console.warn("HyperNode.initInfo is not implemented")}},{key:"sceneNode",get:function(){return this._node}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parent}},{key:"matrix",get:function(){return this.sceneNode.matrix}},{key:"matrixWorld",get:function(){return this.sceneNode.matrixWorld}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e}},{key:"type",get:function(){return this._property.type}},{key:"property",get:function(){return JSON.parse(JSON.stringify(this._property))},set:function(e){this._property=JSON.parse(JSON.stringify(e))}},{key:"JSON",get:function(){for(var e=[],t=0;t<this.children.length;t++)e.push(this.children[t].JSON);return{property:this.property,children:e}}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtmosphereSelfShaderMaterial=t.GroundSelfShaderMaterial=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l={Kr:.0025,Km:.001,ESun:20,g:-.95,innerRadius:.999,outerRadius:1.00505,wavelength:[.65,.57,.475],scaleDepth:.25},u={uniforms:{v3LightPosition:{type:"v3",value:new o.Vector3(1,1,1).normalize()},focus:{type:"v3",value:new o.Vector3(0,0,0)},v3InvWavelength:{type:"v3",value:new o.Vector3(1/Math.pow(l.wavelength[0],4),1/Math.pow(l.wavelength[1],4),1/Math.pow(l.wavelength[2],4))},fInnerRadius:{type:"f",value:l.innerRadius},fInnerRadius2:{type:"f",value:l.innerRadius*l.innerRadius},fOuterRadius:{type:"f",value:l.outerRadius},fOuterRadius2:{type:"f",value:l.outerRadius*l.outerRadius},fKrESun:{type:"f",value:l.Kr*l.ESun},fKmESun:{type:"f",value:l.Km*l.ESun},fKr4PI:{type:"f",value:4*l.Kr*Math.PI},fKm4PI:{type:"f",value:4*l.Km*Math.PI},fScale:{type:"f",value:1/(l.outerRadius-l.innerRadius)},fScaleDepth:{type:"f",value:l.scaleDepth},fScaleOverScaleDepth:{type:"f",value:1/(l.outerRadius-l.innerRadius)/l.scaleDepth},g:{type:"f",value:l.g},g2:{type:"f",value:l.g*l.g},nSamples:{type:"i",value:3},fSamples:{type:"f",value:3},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:2}},vertexShader_atmosphere:"\n  //\n  // Atmospheric scattering vertex shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n  uniform float fOuterRadius2;  // fOuterRadius^2\n  uniform float fInnerRadius;   // The inner (planetary) radius\n  uniform float fInnerRadius2;  // fInnerRadius^2\n  uniform float fKrESun;      // Kr * ESun\n  uniform float fKmESun;      // Km * ESun\n  uniform float fKr4PI;     // Kr * 4 * PI\n  uniform float fKm4PI;     // Km * 4 * PI\n  uniform float fScale;     // 1 / (fOuterRadius - fInnerRadius)\n  uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\n  const int nSamples = 3;\n  const float fSamples = 3.0;\n  varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying float depth;\n  uniform vec3 v3LightPosition;\n\n  varying vec3 ncenter;\n\n  float scale(float fCos)\n  {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n  void main(void)\n  {\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n\n    vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;\n    ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;\n    vec3 translatedPosition = modelPos - ncenter;\n    vec3 translatedCameraPosition = cameraPosition - ncenter;\n\n    float fCameraHeight = max(0.0, length(cameraPosition - ncenter));\n    float fCameraHeight2 = pow(fCameraHeight, 2.0);\n\n    // v3LightPosition = normalize(vec3(1e8, 1e8, 1e8));\n\n    vec3 v3Ray = translatedPosition - translatedCameraPosition;\n\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n    vec3 v3Start;\n    float fStartOffset;\n    if(fCameraHeight>fOuterRadius){\n      // camera in space\n      // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n      float B = 2.0 * dot(translatedCameraPosition, v3Ray);\n      float C = fCameraHeight2 - fOuterRadius2;\n      float fDet = max(0.0, B*B - 4.0 * C);\n      float fNear = 0.5 * (-B - sqrt(fDet));\n      // Calculate the ray's starting position, then calculate its scattering offset\n      v3Start = translatedCameraPosition + v3Ray * fNear;\n      fFar -= fNear;\n      float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n      float fStartDepth = exp(-1.0 / fScaleDepth);\n      fStartOffset = fStartDepth * scale(fStartAngle);\n      depth = clamp(fStartOffset, 0.0, 1.0);\n    }else{\n      // camera in atmosphere\n      v3Start = translatedCameraPosition;\n      float fHeight = length(v3Start);\n\n      // float closeSurfaceDiff = min(0.0001 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));\n      float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      // float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n      \n      float fStartAngle = dot(v3Ray, v3Start) / fHeight;\n      fStartOffset = fDepth*scale(fStartAngle);\n      // float fStartDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n      float fStartDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      depth = clamp(fStartDepth*scale(fStartAngle),0.0,1.0);\n    }\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n      float fHeight = length(v3SamplePoint);\n      // float closeSurfaceDiff = min(0.0001 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      // float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      // if (fInnerRadius >= fHeight) break;\n      float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n      float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n      float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n      float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n      vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n      v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n      v3SamplePoint += v3SampleRay;\n    }\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n\n    v3Direction = translatedCameraPosition - translatedPosition;\n  }\n  ",fragmentShader_atmosphere:"\n  //\n  // Atmospheric scattering fragment shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  uniform float fExposure;\n  uniform vec3 v3LightPosition;\n  uniform float g;\n  uniform float g2;\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n\n  varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying float depth;\n  varying vec3 ncenter;\n\n  // Calculates the Mie phase function\n  float getMiePhase(float fCos, float fCos2, float g, float g2)\n  {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(max(0.0, 1.0 + g2 - 2.0 * g * fCos), 1.5);\n  }\n  // Calculates the Rayleigh phase function\n  float getRayleighPhase(float fCos2)\n  {\n    return 0.75 + 0.75 * fCos2;\n  }\n  void main (void)\n  {\n    float fCameraHeight = length(cameraPosition - ncenter);\n\n    float fCos = dot(v3LightPosition, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n    float rayleighPhase = getRayleighPhase(fCos2);\n    float miePhase = getMiePhase(fCos, fCos2, g, g2);\n    float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(max(0.0, 1.0 + 0.2 - 2.0*(-0.2)*fCos), 1.0);\n    vec3 color = rayleighPhase * c0 +\n            miePhase * c1 +\n            depth * sun * vec3(0.05,0.05,0.1);\n    color = vec3(1.0) - exp(-fExposure*color);\n    float nightmult = clamp(max(color.x, max(color.y, color.z))*1.5,0.0,1.0);\n    gl_FragColor = vec4(color, nightmult);\n    if(fCameraHeight<=fOuterRadius)gl_FragColor.a = nightmult + fOuterRadius - fCameraHeight;\n  }\n  ",vertexShader_ground:"\n  //\n  // Atmospheric scattering vertex shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  // Ported for use with three.js/WebGL by James Baicoianu\n  uniform vec3 v3LightPosition;   // The direction vector to the light source\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  // uniform vec3 focus; // focus point on earth in earth space\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n  uniform float fOuterRadius2;  // fOuterRadius^2\n  uniform float fInnerRadius;   // The inner (planetary) radius\n  uniform float fInnerRadius2;  // fInnerRadius^2\n  uniform float fKrESun;      // Kr * ESun\n  uniform float fKmESun;      // Km * ESun\n  uniform float fKr4PI;     // Kr * 4 * PI\n  uniform float fKm4PI;     // Km * 4 * PI\n  uniform float fScale;     // 1 / (fOuterRadius - fInnerRadius)\n  uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n  uniform sampler2D tDiffuse;\n\n  varying vec3 ncenter;\n\n  // varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying vec2 vUv;\n  const int nSamples = 3;\n  const float fSamples = 3.0;\n  float scale(float fCos)\n  {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n  void main(void)\n  {\n    vec3 ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 translatedPosition = modelPos - ncenter;\n    vec3 translatedCameraPosition = cameraPosition - ncenter;\n\n    float fCameraHeight = max(0.0, length(cameraPosition - ncenter));\n    float fCameraHeight2 = pow(fCameraHeight, 2.0);\n    \n    // vec3 focusWorld = (modelMatrix * vec4(focus, 1.0)).xyz - ncenter;\n    // v3LightPosition = normalize(focusWorld);\n    // vec3 v3LightPosition = normalize(vec3(1e8, 1e8, 1e8));\n\n    vec3 v3Ray = translatedPosition - translatedCameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n    vec3 v3Start;\n    if(fCameraHeight>fOuterRadius){\n        // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n      float B = 2.0 * dot(translatedCameraPosition, v3Ray);\n      float C = fCameraHeight2 - fOuterRadius2;\n      float fDet = max(0.0, B*B - 4.0 * C);\n      float fNear = 0.5 * (-B - sqrt(fDet));\n      // Calculate the ray's starting position, then calculate its scattering offset\n      v3Start = translatedCameraPosition + v3Ray * fNear;\n      fFar -= fNear;\n    }else{\n      v3Start = translatedCameraPosition;\n    }\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, translatedPosition) / length(translatedPosition);\n    float fLightAngle = dot(v3LightPosition, translatedPosition) / length(translatedPosition);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate;\n    for(int i=0; i<nSamples; i++)\n    {\n      float fHeight = length(v3SamplePoint);\n      float closeSurfaceDiff = min(0.6 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      // float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));\n      float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      fCameraOffset = clamp(fCameraOffset, -0.1, 0.1);\n      float fScatter = fDepth*fTemp - fCameraOffset;\n      // float fScatter = fDepth*fTemp;\n      // origianlly float fScatter = fDepth*fTemp - fCameraOffset;\n      v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n      v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n      v3SamplePoint += v3SampleRay;\n    }\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n  }\n  ",fragmentShader_ground:"\n  //\n  // Atmospheric scattering fragment shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  // Ported for use with three.js/WebGL by James Baicoianu\n  uniform float fNightScale;\n  uniform sampler2D tDiffuse;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying vec2 vUv;\n  uniform float fExposure;\n\n  varying vec3 ncenter;\n\n  // void main (void)\n  // {\n  //   vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;\n  //   vec3 diffuseNightTex = diffuseTex * 0.1;\n  //   vec3 day = diffuseTex * c0;\n  //   vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);\n  //   vec3 color = c1 + day + night;\n  //   color = 1.0 - exp(-fExposure * color);\n  //   gl_FragColor = vec4(color, 1.0);\n  // }\n\n  void main (void)\n  {\n    vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;\n    vec3 diffuseNightTex = diffuseTex * 0.1;\n    vec3 day = diffuseTex * c0;\n    vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);\n    vec3 color = c1 + day + night;\n    color = 1.0 - exp(-fExposure * color);\n    gl_FragColor = vec4(color, 1.0);\n  }\n  "},c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,s=e.y,l=e.flatShading;i(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c.uniforms=u.uniforms,c.vertexShader=u.vertexShader_atmosphere,c.fragmentShader=u.fragmentShader_atmosphere,c.transparent=!0,c.extensions.derivatives=!0,c.side=o.BackSide,c.level=r,c.x=n,c.y=s,c.flatShading=l,c}return s(t,o.ShaderMaterial),t}(),h=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.map,n=e.level,o=e.x,s=e.y,l=e.flatShading,c=e.transparent,h=void 0===c||c;i(this,t);var f=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));f.uniforms={tDiffuse:{type:"t",value:r}};for(var d=Object.keys(u.uniforms),p=0;p<d.length;p++)f.uniforms[d[p]]=u.uniforms[d[p]];return f.vertexShader=u.vertexShader_ground,f.fragmentShader=u.fragmentShader_ground,f.transparent=h,f.extensions.derivatives=!0,f.level=n,f.x=o,f.y=s,f.flatShading=l,f}return s(t,o.ShaderMaterial),n(t,[{key:"map",set:function(e){this.uniforms.tDiffuse.value=e},get:function(){return this.uniforms.tDiffuse.value}},{key:"sun",set:function(e){this.uniforms.v3LightPosition.value.copy(e)},get:function(){return this.uniforms.v3LightPosition.value}}]),t}();t.GroundSelfShaderMaterial=h,t.AtmosphereSelfShaderMaterial=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(18),a=(n=i)&&n.__esModule?n:{default:n},s=r(0);var l=function(){function e(t){var r=this,n=t.parent,o=t.filename,i=t.basepath,a=t.sceneGraphRoot,l=t.showBbox,u=void 0!==l&&l,c=t.globalCenter,h=t.globalScale,f=t.level;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=o,this.level=f,this.parent=n,this.basepath=i,this.sceneGraphRoot=a,this.showBbox=u,this._globalCenter=c,this._globalScale=h,this.sceneNode=new s.Object3D,this.sceneNode.position.set(-this._globalCenter.x*this._globalScale,-this._globalCenter.y*this._globalScale,-this._globalCenter.z*this._globalScale),this.sceneNode.scale.set(this._globalScale,this._globalScale,this._globalScale),this.sceneNode.updateMatrix(),this.contentHolder=new s.Object3D,this.contentHolder.name="contentHolder",this._interactShape=new s.Object3D,this._interactShape.name="interactshape",this.showBbox||(this._interactShape.visible=!1),this.sceneNode.add(this.contentHolder,this._interactShape),this.nodes=[],this.loaded=!1,this.loading=!1,this.pruned=!1,this.childNodePromise=void 0,this.readyResolver=void 0,this.isReadyPromise=new Promise(function(e,t){r.readyResolver=e}),this.visible=!0,this.texMaterial=void 0}return o(e,[{key:"getReady",value:function(){return this.isReadyPromise}},{key:"childrenDownloaded",value:function(){var e=this;return this.childNodePromise.then(function(){if(0===e.nodes.length)return Promise.reject(new Error("Leaf node does not have child"));var t=[];return e.nodes.map(function(e){t.push(e.getReady())}),Promise.all(t)})}},{key:"destruct",value:function(){}},{key:"dispose",value:function(){return this.removeFromScene(),this.pruned=!0,!0}},{key:"loadTile",value:function(){var t=this;return this.loaded?Promise.resolve(this.nodes.length):this.loading?this.childNodePromise:(this.loading=!0,this.childNodePromise=new Promise(function(r,n){a.default.get(t.basepath+t.name).then(function(n){var o=n.data;if("Geode"===o.type)r(0),t._parseGeode2Mesh(o).then(function(e){t.loaded=!0,t.loading=!1,t.contentHolder.add(e[0]),t._interactShape.add(e[1]),t.readyResolver()});else if("PagedLOD"===o.type)t._parseGeode2Mesh(o.Geode).then(function(e){t.loaded=!0,t.loading=!1,t.contentHolder.add(e[0]),t._interactShape.add(e[1]),t.readyResolver()}),t.nodes.push(new e({filename:o.nextFile,basepath:t.basepath,parent:t,showBbox:t.showBbox,globalCenter:t._globalCenter,globalScale:t._globalScale,level:t.level+1,sceneGraphRoot:t.sceneGraphRoot})),r(1);else if("Group"===o.type){for(var i=0;i<o.children.length;++i)t.nodes.push(new e({filename:o.children[i].nextFile,basepath:t.basepath,parent:t,showBbox:t.showBbox,globalCenter:t._globalCenter,globalScale:t._globalScale,level:t.level+1,sceneGraphRoot:t.sceneGraphRoot}));r(o.children.length),(new s.TextureLoader).load(t.basepath+o.StateSet.texture.file,function(e){t.texMaterial=new s.MeshBasicMaterial({color:16777215,map:e,side:s.FrontSide});for(var r=[],n=0;n<o.children.length;++n)r.push(t._parseGeode2Mesh(o.children[n].Geode));Promise.all(r).then(function(e){var r=new s.Object3D;e.map(function(e){t.contentHolder.add(e[0]),r.add(e[1])});var n=(new s.Box3).setFromObject(r),o=new s.BoxBufferGeometry(n.max.x-n.min.x,n.max.y-n.min.y,n.max.z-n.min.z),i=[(n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2,(n.max.z+n.min.z)/2];o.translate(i[0],i[1],i[2]),t._interactShape.add(new s.Mesh(o,new s.MeshBasicMaterial({wireframe:!0,color:16776960}))),r.children.map(function(e){e.geometry.dispose(),e.material.dispose(),e=void 0}),r=void 0,t.loaded=!0,t.loading=!1,t.readyResolver()})},function(){console.error("Group texture loading error")})}else console.warn("unsupported data type",o)})}),this.childNodePromise)}},{key:"_parseGeode2Mesh",value:function(e){var t=this,r=new s.BufferGeometry;r.setIndex(e.Geometry.primitiveSets[0].faces),r.addAttribute("position",new s.BufferAttribute(new Float32Array(e.Geometry.vertexArray),3)),r.addAttribute("uv",new s.BufferAttribute(new Float32Array(e.Geometry.texCoordArray),2));var n=e.Geometry.bbox,o=n.max[0]-n.min[0],i=n.max[1]-n.min[1],a=n.max[2]-n.min[2],l=e.Geometry.center,u=new s.BoxBufferGeometry(o,i,a);u.translate(l[0],l[1],l[2]);var c=new s.Mesh(u,new s.MeshBasicMaterial({color:16776960,wireframe:!0}));return new Promise(function(n,o){if(t.texMaterial)n([new s.Mesh(r,t.texMaterial),c]);else{var i=e.Geometry.StateSet.texture;(new s.TextureLoader).load(t.basepath+i.file,function(e){t.texMaterial=new s.MeshBasicMaterial({color:16777215,map:e,side:s.FrontSide}),n([new s.Mesh(r,t.texMaterial),c])},function(){console.error("texture loading error")})}})}},{key:"isInScene",value:function(){return null!==this.sceneNode.parent}},{key:"isAncestorInScene",value:function(){for(var e=this.parent;void 0!==e;){if(e.isInScene())return!0;e=e.parent}return!1}},{key:"removeFromScene",value:function(){return!!this.sceneNode.parent&&(this.sceneNode.parent.remove(this.sceneNode),!0)}},{key:"addToScene",value:function(){return this.sceneGraphRoot.add(this.sceneNode),!0}},{key:"isInFrustum",value:function(e){return e.intersectsObject(this._interactShape)}},{key:"screenArea",value:function(e){if(0===this._interactShape.children.length)return 0;for(var t=[],r=this._interactShape.children[0].geometry.getAttribute("position"),n=0;n<r.count;n+=3){var o=new s.Vector3(r.array[n],r.array[n+1],r.array[n+2]).applyMatrix4(this.sceneNode.matrix).applyMatrix4(this.sceneGraphRoot.matrixWorld);t.push(o)}return i([0,1,2,3])+i([7,6,5,4])+.8*i([3,2,6,7])+.8*i([5,6,2,1])+.8*i([4,5,1,0])+.8*i([0,3,7,4]);function i(r){for(var n=[],o={front:!1,back:!1},i=0;i<r.length;i++){var a=r[i];if(n[i]=t[a].clone(),n[i].applyMatrix4(e.projectionMatrix),n[i].z>1&&(o.back=!0),n[i].z<1&&(o.front=!0),o.front&&o.back)return.5;n[i].x=p(n[i].x,-1,1),n[i].y=p(n[i].y,-1,1),n[i].z=0}var l=0,u=(new s.Vector3).subVectors(n[0],n[2]),c=(new s.Vector3).subVectors(n[0],n[1]),h=(new s.Vector3).subVectors(n[0],n[3]),f=c.clone().cross(u),d=u.clone().cross(h);return f.z*d.z<0?l=Math.max(f.z,d.z):(l+=.5*f.z,l+=.5*d.z),l<0&&(l=0),isNaN(l)&&(console.warn("wrong area"),console.warn(JSON.stringify(n)),console.warn(JSON.stringify(r))),l;function p(e,t,r){return e<=t?t:e>=r?r:e}}}},{key:"setVisibility",value:function(e){this.visible=e,this.isInScene()&&(this.sceneNode.visible=e)}},{key:"displayByload",value:function(){var e=!1;return e=void 0===this.parent?this._addToSceneAsync()&&e:this._replaceParentAttempt()&&e}},{key:"_addToSceneAsync",value:function(){return this.addToScene(),this._beReplacedAttempt(),!0}},{key:"_beReplacedAttempt",value:function(){var e=!0;if(!this.isInScene())return console.error("not in scene but be replaced atttempt"),e=!1;if(0===this.nodes.length)e=!1;else{for(var t=!0,r=0;r<this.nodes.length&&(t=this.nodes[r].loaded&&t);r++);if(t){this.removeFromScene();for(var n=0;n<this.nodes.length;n++)this.nodes[n]._addToSceneAsync();e=!0}}return e}},{key:"_replaceParentAttempt",value:function(){var e=!1;if(!this.loaded)return e=!1;if(void 0===this.parent)this._addToSceneAsync(),e=!0;else{for(var t=this.parent.nodes,r=!0,n=0;n<t.length&&(r=t[n].loaded&&r);n++);if(r&&this.parent.isInScene()){for(this.parent.removeFromScene(),n=0;n<t.length;n++)t[n]._addToSceneAsync();e=!0}}return e}},{key:"estimatedArea",get:function(){return 0}},{key:"expandable",get:function(){return this.loaded}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,o=e.y,i=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return a.level=r,a.x=n,a.y=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MeshBasicMaterial),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(7),s=(n=a)&&n.__esModule?n:{default:n};var l=function(){function e(t){var r=t.tree,n=t.Type,o=void 0===n?s.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tree=r,this._Type=o}return i(e,[{key:"generateTileMaterial",value:function(e){var t=o({},this.tree.style,e.style);return new this.Type(t)}},{key:"releaseMemoryOf",value:function(e){return!0}},{key:"tree",get:function(){return this._tree}},{key:"Type",set:function(e){this._Type=e},get:function(){return this._Type}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=(n=i)&&n.__esModule?n:{default:n};var s=function(e){function t(e,r){var n=r.name,o=void 0===n?"HyperEntity":n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name=o,i._property.type="HyperEntity",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"initInfo",value:function(){return Promise.reject(new Error("initInfo not impelemented."))}},{key:"box",get:function(){return console.warn("HyperEntity.box is not impelemented"),null}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(44),i=(n=o)&&n.__esModule?n:{default:n};var a=function(e){this.heap=new i.default(e)};a.prototype.constructor=a,a.prototype.enqueue=function(e,t){return this.heap.insert(e,t)},a.prototype.dequeue=function(){return this.heap.extractMinimum()},a.prototype.clear=function(){this.heap.clear()},a.prototype.isEmpty=function(){return this.heap.isEmpty()},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(10)),i=s(r(43)),a=r(3);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var r=t.FOREST_CAPACITY,n=t.CACHE_CAPACITY,o=t.MAX_DOWNLOAD_CONCURRENCY,a=t.MIN_AREA,s=t.MAX_LEVEL,l=t.allowWorker,u=t.trees,c=void 0===u?[]:u,h=t.name,f=void 0===h?"LodForest":h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=f,this.FOREST_CAPACITY=r,this.MAX_DOWNLOAD_CONCURRENCY=o,this.MIN_AREA=a,this.MAX_LEVEL=s,this.allowWorker=l,this.trees=c,this.CACHE_CAPACITY=n,this.CACHE_CAPACITY<this.FOREST_CAPACITY+10&&(this.CACHE_CAPACITY=this.FOREST_CAPACITY+Math.min(100,Math.max(.4*this.FOREST_CAPACITY,10)),console.warn("Cache is too small. Resized to",this.CACHE_CAPACITY)),this.retriever=new i.default({cacheCapacity:this.CACHE_CAPACITY,dockCapacity:o,allowWorker:l})}return n(e,[{key:"destruct",value:function(){var e=!0;return this.trees=[],e=e&&this.retriever.destruct(),this.retriever=null,e}},{key:"clear",value:function(){this.trees=[],this.retriever.clear()}},{key:"add",value:function(e){var t=this._indexOf(e);return-1===t?(this.trees.push(e),!0):(console.warn("tree already exists",e,t),!1)}},{key:"remove",value:function(e){var t=this._indexOf(e);return-1!==t&&(this.trees.splice(t,1),!0)}},{key:"applyToTrees",value:function(e,t){for(var r=!0,n=0;n<this.trees.length;n++)r=e(this.trees[n],t)&&r;return r}},{key:"sceneUpdated",value:function(e){var t=e.camera;if(0===this.trees.length)return!0;var r=this;return this._preUpdateTree({camera:t}).then((0,a.delayPromise)(10)).then(function(){return r._updateTree({camera:t})}).then((0,a.delayPromise)(10)).then(function(){return r._retrieveTiles()}).catch(function(e){return console.error(e),Promise.resolve()})}},{key:"_preUpdateTree",value:function(e){var t=this,r=e.camera;return new Promise(function(e,n){var o=t.applyToTrees(function(e){return!e.preSceneUpdate||e.preSceneUpdate({camera:r})});o?e(o):n(o)})}},{key:"_updateTree",value:function(e){var t=e.camera,r=this;return new Promise(function(e,n){r.__updateTree({camera:t})?e():n(new Error("LodForest::_updateTree"))})}},{key:"__updateTree",value:function(e){e.camera;var t=!0,r=new o.default(function(e,t){return t.key-e.key});this.applyToTrees(function(e){t=e.traverse(e.root,function(e){return e.needsPrune=!0,!0})&&t;var n=e.root,o=f(n),i={node:n,tree:e};r.enqueue(o,i)});var n=0;do{if(n>=this.FOREST_CAPACITY){console.log("LodForest full",n,"/",this.FOREST_CAPACITY,this.trees);break}var i=r.dequeue(),a=i.key,s=i.value.node,l=i.value.tree;if(a<this.MIN_AREA){console.log("LodForest tile reaches area",a,this.MIN_AREA);break}if(s.needsPrune=!1,s.level<this.MAX_LEVEL&&s.level<l.maxLevel&&s.expandable){0===s.nodes.length&&(t=l.expand(s)&&t);for(var u=0;u<s.nodes.length;u++){var c=s.nodes[u];c.needsPrune=!0;var h=f(c);h>=this.MIN_AREA&&r.enqueue(h,{tree:l,node:c})}n+=s.nodes.length}}while(!r.isEmpty());return console.log("nodeCnt",n),r.clear(),r=void 0,this.applyToTrees(function(e){t=e.traverse(e.root,function(t){return!t.needsPrune||e.prune(t)})&&t}),t;function f(e){var t=e.screenArea;return e.ssArea=t,t}}},{key:"_retrieveTiles",value:function(){var e=this.retriever.abortPending(),t=this,r=new o.default(function(e,t){return t.key-e.key}),n=new o.default(function(e,t){return t.key-e.key});this.applyToTrees(function(e){var t=e.root.ssArea,o={tree:e,node:e.root};r.enqueue(t,o),n.enqueue(t,o)});for(var i=[];!r.isEmpty();){var a=r.dequeue(),s=p(a.value.tree,a.value.node);i.push(s)}for(;!n.isEmpty();)for(var l=n.dequeue(),u=l.value.tree,c=l.value.node.nodes,h=0;h<c.length;h++){var f=c[h],d=p(u,f);i.push(d),n.enqueue(f.ssArea,{tree:u,node:f})}return e.then(function(){return Promise.all(i)});function p(e,r){return t.retriever.request(r).then(function(t){if(!r.expired){if(!r.loaded){var n=r.digest(t);r.onContentLoaded(n),r.displayByload(),e.flags.modelInitialized||e._onContentInitialized()}return Promise.resolve()}return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"timeout"===e.message||"expired"===e.message||console.warn("[Network unstable] LodForest._retrieveTiles",e),Promise.resolve()})}}},{key:"_indexOf",value:function(e){return(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this.trees,e)}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=(n=i)&&n.__esModule?n:{default:n};var s=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.EntityType=r,o.options=n,o._property.type="HyperLayer",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"startImport",value:function(){for(var e=this.options.dataSeeds,t=[],r=0;r<e.length;r++){var n=new(0,this.EntityType)(this,e[r]),o=this._import(n);t.push(o)}return Promise.all(t)}},{key:"_import",value:function(e){return e.startImport().then(function(){return Promise.resolve(1)}).catch(function(e){return console.error("import error:",e),Promise.resolve(0)})}},{key:"clear",value:function(){console.warn("clear is not implemented")}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){var r=t.camera,n=t.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._camera=r,this._domElement=n,this._rayCaster=new o.Raycaster,this.mouseOffsetNeedsUpdate=!0}return n(e,[{key:"destruct",value:function(){this._camera=void 0,this._domElement=void 0,this._rayCaster=void 0,this.mouseOffsetNeedsUpdate=!1}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,i=r.y;return this._rayCaster.setFromCamera(new o.Vector2(n,i),this.camera),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"_NDC",value:function(e,t){var r=this.mouseOffset;return e-=r.left,t-=r.top,{x:e=e/this.domWidth*2-1,y:t=-t/this.domHeight*2+1}}},{key:"_NDC_inv",value:function(e,t){var r=this.mouseOffset;return{x:(e+1)/2*this.domWidth+r.left,y:(1-t)/2*this.domHeight+r.top}}},{key:"_updateMouseOffset",value:function(){var e=this._domElement.getBoundingClientRect();this._mouseOffset={left:e.left,top:e.top},this.mouseOffsetNeedsUpdate=!1}},{key:"camera",get:function(){return this._camera}},{key:"mouseOffset",get:function(){return this.mouseOffsetNeedsUpdate&&this._updateMouseOffset(),this._mouseOffset}},{key:"domWidth",get:function(){return this._domElement.clientWidth}},{key:"domHeight",get:function(){return this._domElement.clientHeight}},{key:"targets",get:function(){return[]}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=(n=i)&&n.__esModule?n:{default:n};var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,o=t.lat,i=void 0===o?0:o,a=t.alt,s=void 0===a?0:a,l=t.north,u=void 0===l?0:l,c=t.tilt,h=void 0===c?0:c,f=t.up,d=void 0===f?0:f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=i,this.alt=s,this.north=u,this.tilt=h,this.up=d}return o(e,[{key:"reset",value:function(){this.lng=0,this.lat=0,this.alt=0,this.north=0,this.tilt=0,this.up=0}},{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"lng",set:function(e){(e%=360)>=180?e-=360:e<=-180&&(e+=360),this._lng=e},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(87,e),-87)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*a.default.EARTH_RADIUS,e)},get:function(){return this._alt}},{key:"north",set:function(e){e=(e%360+360)%360,this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,o=e.north,i=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==o&&(this._pose.north=o),void 0!==i&&(this._pose.tilt=i),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var s=i.set;void 0!==s&&s.call(o,n)}return n},i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},a=c(r(14)),s=c(r(1)),l=c(r(52)),u=r(0);function c(e){return e&&e.__esModule?e:{default:e}}var h=Math.PI/180,f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r._mat=new u.Matrix4,r._anchor=new u.Vector3,r._orbitSphDelta=new u.Spherical(0,0,0),r._swirlSphDelta=new u.Spherical(0,0,0),r.needsApplyDelta=!1,r.matNeedsUpdate=!1,r.poseNeedsUpdate=!1;var n=Object.assign({},{earth_scale:1,EARTH_RESOLUTION:6,minTilt:10,maxTilt:40,minNorth:0,maxNorth:360,minAlt:.1,maxAlt:2*s.default.EARTH_RADIUS},e);return r.earth_scale=n.earth_scale,r.EARTH_RESOLUTION=n.EARTH_RESOLUTION,r._minTilt=n.minTilt,r._maxTilt=n.maxTilt,r._minAlt=n.minAlt,r._maxAlt=n.maxAlt,r.minPolarAngleVert=10*h,r.maxPolarAngleVert=170*h,r._updateMat(!0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){return this.reset(),!0}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"reset",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this._onPoseChange(),this._updateMat(!0)}},{key:"clone",value:function(){console.warn("ni")}},{key:"_updateMat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.matNeedsUpdate||e){var t=s.default.getLocalSystemOnEarthSurface(this.EARTH_RESOLUTION,this.lng,this.lat,this.earth_scale),r=t.origin,n=t.alt,o=this.tilt/180*Math.PI,i=this.north/180*Math.PI,a=new u.Spherical(this.alt/s.default.EARTH_RADIUS*this.earth_scale,o,i),l=(new u.Vector3).setFromSpherical(a),c=this._sphereLocalCoordinates(n.clone()),h=c.x.clone().multiplyScalar(l.x).add(c.y.clone().multiplyScalar(l.y)).add(c.z.clone().multiplyScalar(l.z)).add(r),f=c.z.clone().negate();f.applyAxisAngle(c.y.clone(),i);var d=(new u.Matrix4).lookAt(h,r.clone(),f);d.setPosition(h),this._mat.copy(d)}this.matNeedsUpdate=!1}},{key:"_updatePose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.poseNeedsUpdate||e)&&this._matToPose(),this.poseNeedsUpdate=!1}},{key:"_matToPose",value:function(e){var r=void 0;if(e&&!e.equals(this.matrix)?r=t._earthPicker.intersect(e.clone()):(e=this.matrix,r=this._centerIntersection()),r){var n=r.clone();return this._matToPoseWithAnchor(e,n)}}},{key:"_matToPoseWithAnchor",value:function(e,r){var n=this.EARTH_RESOLUTION,i=this.earth_scale,a=s.default.earthSurfaceToGeographic(n,r,i),l=a.lng,u=a.lat,c=this._matToAltNorthTiltWithAnchor(e,r),h={lng:l,lat:u,alt:c.alt,north:c.north,tilt:c.tilt,up:0};return h.tilt>=0&&h.tilt<=t.MAX_TILT||(console.warn("invalid tilt",h.tilt),h.tilt=Math.max(0,Math.min(t.MAX_TILT,h.tilt))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",h.lng,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",h.lat,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",h.alt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",h.north,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",h.tilt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",h.up,this),{lng:this._lng,lat:this._lat,alt:this._alt,north:this._north,tilt:this._tilt,up:this._up}}},{key:"_matToAltNorthTiltWithAnchor",value:function(e,t){var r=this.earth_scale,n=(new u.Vector3).setFromMatrixPosition(e),o=this._toEarthLocalSpherical(n,t).sph;return{alt:Math.max(o.radius/r*s.default.EARTH_RADIUS,.1),north:o.theta/Math.PI*180,tilt:o.phi/Math.PI*180}}},{key:"_onPoseChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.matNeedsUpdate=!0)}},{key:"_onMatChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.poseNeedsUpdate=!0)}},{key:"_sphereLocalCoordinates",value:function(e,t){var r=new u.Vector3,n=new u.Vector3,o=new u.Vector3;return t||(t=new u.Vector3(0,1,0)),n.copy(e).normalize(),0===n.lengthSq()&&(n.z=1),r.crossVectors(t,n).normalize(),0===r.lengthSq()&&(n.z+=1e-4,r.crossVectors(t,n).normalize()),o.crossVectors(r,n),{x:r,y:n,z:o}}},{key:"_toEarthLocalSpherical",value:function(e,t){var r=this._sphereLocalCoordinates(t),n=e.clone().sub(t),o=new u.Vector3(n.clone().dot(r.x),n.clone().dot(r.y),n.clone().dot(r.z)),i=new u.Spherical;return i.setFromVector3(o),{sph:i,x:r.x,y:r.y,z:r.z}}},{key:"orbitLeft",value:function(e){if(0!==e){var t=this.anchor,r=this.matrix.clone(),n=new u.Vector3(r.elements[12],r.elements[13],r.elements[14]),o=t.distanceTo(n);o=Math.max(1/s.default.EARTH_RADIUS*this.earth_scale,Math.min(o,this.earth_scale));var i=45*Math.PI/180,a=o*Math.tan(i/2),l=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.theta+=e*l,this.needsApplyDelta=!0}}},{key:"orbitUp",value:function(e){if(e){var t=this.anchor,r=this.matrix.clone(),n=new u.Vector3(r.elements[12],r.elements[13],r.elements[14]),o=t.distanceTo(n);o=Math.max(1/s.default.EARTH_RADIUS*this.earth_scale,Math.min(o,this.earth_scale));var i=45*h,a=o*Math.tan(i/2),l=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.phi+=e*l,this.needsApplyDelta=!0}}},{key:"dolly",value:function(e){0!==e&&(this._orbitSphDelta.radius+=e,this.needsApplyDelta=!0)}},{key:"swirlLeft",value:function(e){this._swirlSphDelta.theta+=e*h,this.needsApplyDelta=!0}},{key:"swirlUp",value:function(e){this._swirlSphDelta.phi+=e*h,this.needsApplyDelta=!0}},{key:"applyDelta",value:function(){if(this.needsApplyDelta){var e=this.matrix.clone(),t=this.anchor,r=(new u.Vector3).setFromMatrixPosition(e),n=new u.Vector3(1,0,0).transformDirection(e),o=new u.Vector3(0,1,0).transformDirection(e),i=void 0;if(this._orbitSphDelta.radius){var a=s.default.EARTH_RADIUS/this.earth_scale,l=r.clone().sub(t),c=1+this._orbitSphDelta.radius/10;c=Math.max(.01,c);var h=l.length()*c,f=void 0;f=h>this.maxAlt/a?t.clone().addScaledVector(l.clone().normalize(),this.maxAlt/a):h<this.minAlt/a?t.clone().addScaledVector(l.clone().normalize(),this.minAlt/a):t.clone().addScaledVector(l,c),i=e.clone().setPosition(f)}else i=e;var d=i.clone();if(this._swirlSphDelta.theta){var p=t.clone().normalize(),v=(new u.Matrix4).makeRotationAxis(p,this._swirlSphDelta.theta);d.premultiply((new u.Matrix4).getInverse(v))}if(this._swirlSphDelta.phi){var y=(new u.Matrix4).setPosition(t.clone().negate()),m=(new u.Matrix4).makeRotationAxis(n,this._swirlSphDelta.phi),g=(new u.Matrix4).setPosition(t).multiply(m).multiply(y),A=(new u.Matrix4).getInverse(g).multiply(d),_=(new u.Vector3).setFromMatrixPosition(A),b=new u.Vector3(0,1,0).transformDirection(A),w=new u.Vector3(0,0,-1).transformDirection(A).normalize(),x=_.clone().projectOnVector(w).clone().negate().add(_);x.length()>=.98*this.earth_scale||x.clone().dot(b)<=0||d.premultiply((new u.Matrix4).getInverse(g));var O=(new u.Matrix4).getInverse(d),S=(new u.Vector3).setFromMatrixPosition(O);if(0!==S.x){var k=t.clone().applyMatrix4(O),E=S.clone().sub(k).normalize(),T=E.clone().setX(0).normalize(),P=(new u.Matrix4).setPosition(k.clone().negate()).premultiply((new u.Matrix4).makeRotationFromQuaternion((new u.Quaternion).setFromUnitVectors(E,T))).premultiply((new u.Matrix4).setPosition(k.clone()));d.multiply((new u.Matrix4).getInverse(P))}}var M=(new u.Matrix4).identity();if(this._orbitSphDelta.theta){var C=(new u.Matrix4).makeRotationAxis(o,this._orbitSphDelta.theta);M.copy(C)}if(this._orbitSphDelta.phi){var R=(new u.Matrix4).makeRotationAxis(n,this._orbitSphDelta.phi);M.multiply(R)}var L=(new u.Matrix4).getInverse(M).multiply(d);this.matrix=L,this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._orbitSphDelta.radius=0,this.needsApplyDelta=!1}}},{key:"putAnchor",value:function(e){return e?this._anchor.copy(e):this._updateAnchor()}},{key:"recommendedFrustum",value:function(e){e.camera,e.targetFocus}},{key:"_updateAnchor",value:function(){var e=this._centerIntersection();return e&&this._anchor.copy(e),this.anchor}},{key:"_centerIntersection",value:function(){return t._earthPicker.intersect(this.matrix)}},{key:"matrix",get:function(){return this._updateMat(),this._mat.clone()},set:function(e){e.isMatrix4?e.equals(this.matrix)||(this._mat.copy(e),this._onMatChange()):console.error("Unknown matrix",e)}},{key:"POS",get:function(){var e=new u.Vector3,t=new u.Quaternion,r=new u.Vector3;return this.matrix.clone().decompose(e,t,r),{position:e,orientation:t,scale:r}}},{key:"value",get:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"value",this)},set:function(e){var t=Object.assign({},this.value,e);this.lng=t.lng,this.lat=t.lat,this.alt=t.alt,this.north=t.north,this.tilt=t.tilt,this.up=t.up}},{key:"lng",set:function(e){isNaN(e)||e===this.lng||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",this)}},{key:"lat",set:function(e){isNaN(e)||e===this.lat||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",this)}},{key:"alt",set:function(e){!isNaN(e)&&e!==this.alt&&e>=.1&&(void 0===this.minAlt&&void 0===this.maxAlt||(e=Math.max(this.minAlt,Math.min(this.maxAlt,e))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",this)}},{key:"north",set:function(e){isNaN(e)||e===this.north||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",this)}},{key:"tilt",set:function(e){e=Math.max(0,Math.min(t.MAX_TILT,e)),isNaN(e)||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",this)}},{key:"up",set:function(e){isNaN(e)||e===this.up||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",this)}},{key:"anchor",set:function(e){this._anchor.copy(e)},get:function(){return this._anchor.clone()}},{key:"maxAlt",set:function(e){(e=Math.max(.1,Math.min(2*s.default.EARTH_RADIUS,e)))<this.minAlt&&(console.warn("altRangeMax",e,this.minAlt),this._minAlt=e),this._maxAlt=e},get:function(){return this._maxAlt}},{key:"minAlt",set:function(e){(e=Math.max(.1,Math.min(2*s.default.EARTH_RADIUS,e)))>this.maxAlt&&(console.warn("altRangeMin",e,this.maxAlt),this._maxAlt=e),this._minAlt=e},get:function(){return this._minAlt}},{key:"maxTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))<this.minTilt&&(console.warn("TiltRangeMax",e,this.minTilt),this._minTilt=e),this._maxTilt=e},get:function(){return this._maxTilt}},{key:"minTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))>this.maxTilt&&(console.warn("TiltRangeMin",e,this.maxTilt),this._maxTilt=e),this._minTilt=e},get:function(){return this._minTilt}},{key:"distanceToAnchor",get:function(){var e=(new u.Vector3).setFromMatrixPosition(this.matrix),t=this.anchor;return e.distanceTo(t)}}],[{key:"MAX_TILT",get:function(){return 75}}]),t}();f._earthPicker=new l.default,t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={scale:1,resolution:6}},function(e,t,r){var n,o,i,a,s,l,u,c;e.exports=(n=r(2),r(58),r(57),i=(o=n).lib,a=i.Base,s=i.WordArray,l=o.algo,u=l.MD5,c=l.EvpKDF=a.extend({cfg:a.extend({keySize:4,hasher:u,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),o=s.create(),i=o.words,a=r.keySize,l=r.iterations;i.length<a;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<l;c++)u=n.finalize(u),n.reset();o.concat(u)}return o.sigBytes=4*a,o}}),o.EvpKDF=function(e,t,r){return c.create(r).compute(e,t)},n.EvpKDF)},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._version="0.0.1"}return n(e,null,[{key:"detectIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}},{key:"isMobile",get:function(){return!(!navigator||!navigator.userAgent)&&/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent)}},{key:"canvas",get:function(){return!!window.CanvasRenderingContext2D}},{key:"webgl",get:function(){return function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}()}},{key:"workers",get:function(){return!!window.Worker}},{key:"browser",get:function(){return{isWeChat:navigator.userAgent.indexOf("MicroMessenger")>=0,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome,isIE:!!document.documentMode}}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=l(r(63)),a=l(r(19)),s=l(r(62));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(e){var t={renderItems:{background:{transparent:!1,opacity:.8,color:2565927,image:void 0}},debug:!1};e&&e.HOST&&e.api&&e.api.apiUrl&&e.api.key||console.warn("Altizure authorization is Missing. Altizure services will not be available.");return Object.assign({},t,e)}(r);this._dop=n;var a=this;this.debug=n.debug,this._HOST=n.HOST,this.rootContainer=null,this.threeContainer=null,this.renderer=null,this.scene=null,this.camera=null,this.effect=null,this._freeze=!1,this._live=!1,this.layers={},this.control=null,window.viewer=this,function(){if(a.rootContainer=document.getElementById(t),!a.rootContainer)return console.error("Invalid "+t),!1;if(a.threeContainer=i.default.createThree(a.rootContainer,n.renderItems.background.image),!a.env.webgl){if(a.env.browser.isWeChat){var e=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return i.default.createMessageDiv(a.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+e+'".',n.renderItems.background.color),!1}return i.default.createMessageDiv(a.rootContainer,"No WebGL Support",n.renderItems.background.color,"/support/articles/faq_compatibility"),!1}}(),function(){a.scene=new o.Scene;var e={eye:new o.Vector3(0,0,0),NEAR:a.scale/1e10,FAR:6*a.scale},t=a.width/a.height,r=e.NEAR,i=e.FAR;a.camera=new o.PerspectiveCamera(45,t,r,i),a.scene.add(a.camera),a.camera.position.copy(e.eye);var s=n.renderItems.background;a.renderer=new o.WebGLRenderer({antialias:!0,alpha:s.transparent}),a.renderer.setClearColor(new o.Color(s.color),s.transparent?s.opacity:void 0),a.renderer.setPixelRatio(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),a.renderer.setSize(a.width,a.height),a.renderer.context.getExtension("OES_standard_derivatives"),a.threeContainer.appendChild(a.renderer.domElement);var l=new o.AmbientLight(16777215,1),u=new o.PointLight(13696511,1.1,0);u.color.setHex(16777215),u.position.set(0,0,0),a._lights={ambient:l,point:u};var c=new o.PointLight(16777215,1);c.position.set(20,50,50),a.scene.add(c)}(),this._live=!0,function e(){if(!a.isUpdating)return;a.control&&a.control.update();a.animate();a.render();a._stats&&a._stats.update();requestAnimationFrame(e)}()}return n(e,[{key:"destruct",value:function(){return this.layers={},this.isInitialized=!1,this.layersReady=null,this.control&&(this.control.destruct(),this.control=void 0),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer=null,this._welcomeMesh&&(this._welcomeMesh.geometry.dispose(),this._welcomeMesh.material.dispose(),this._welcomeMesh=void 0),this._live=!1,window.viewer=void 0,!0}},{key:"freeze",value:function(){this._freeze=!0}},{key:"unfreeze",value:function(){this._freeze=!1}},{key:"animate",value:function(){}},{key:"render",value:function(){this.effect?this.effect.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera)}},{key:"cameraChangeHandler",value:function(){}},{key:"updateViewDependentContent",value:function(){}},{key:"updateViewDependentVisibility",value:function(){}},{key:"attachEffect",value:function(e,t){return this.threeContainer&&this.renderer?(this.effect=new e(this.renderer,t),this.effect&&this.effect.setSize(this.width,this.height),this.effect):(console.error("The renderer has not been initialized"),null)}},{key:"resize",value:function(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect&&this.effect.setSize(this.width,this.height)}},{key:"_updateVisibility",value:function(){if(!this.isInitialized)return!1;this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0),this.camera.updateProjectionMatrix(),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);var e=new o.Frustum;e.setFromMatrix((new o.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));var t={frustum:e};for(var r in this.layers)this.layers[r]&&this.layers[r].updateVisibility(t);return!0}},{key:"env",get:function(){return Object.defineProperty(this,"env",{value:{isMobile:a.default.isMobile,webgl:a.default.webgl,browser:a.default.browser,workers:a.default.workers},writable:!1,configurable:!0}),this.env}},{key:"width",get:function(){return this.threeContainer.clientWidth}},{key:"height",get:function(){return this.threeContainer.clientHeight}},{key:"HOST",get:function(){return this._HOST}},{key:"api",get:function(){return Object.defineProperty(this,"api",{value:new s.default({apiUrl:this._dop.api.apiUrl,key:this._dop.api.key,altitoken:this._dop.api.altitoken}),writable:!1,configurable:!0}),this.api},set:function(e){var t=e.apiUrl,r=e.key,n=e.altitoken;t&&(this.api.apiUrl=t),r&&(this.api.key=r),n&&(this.api.altitoken=n)}},{key:"countryName",get:function(){var e=this;return this.api.getCountryName().catch(function(e){return console.warn(e),Promise.resolve("China")}).then(function(t){return Object.defineProperty(e,"countryName",{value:Promise.resolve(t),writable:!1,configurable:!0}),t})}},{key:"lights",get:function(){return this._lights}},{key:"isFreezing",get:function(){return this._freeze}},{key:"isLiving",get:function(){return this._live}},{key:"isUpdating",get:function(){return!this.isFreezing&&this.isLiving}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(6),a=(n=i)&&n.__esModule?n:{default:n};var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="OSGTree",this.basepath=t.basepath,this.sceneGraphRoot=t.sceneGraphRoot,this.root=new a.default({filename:t.root,basepath:t.basepath,showBbox:t.showBbox,globalCenter:t.globalCenter,globalScale:t.globalScale,level:0,sceneGraphRoot:this.sceneGraphRoot}),this.numOfNodes=1,this.maxLevel=t.maxLevel,this.minLevel=t.minLevel,this.expand(this.root)}return o(e,[{key:"expand",value:function(e){var t=this;return e.nodes.length>0?Promise.resolve():e.loadTile().then(function(e){t.numOfNodes+=e})}},{key:"dispose",value:function(e){for(var t=!0,r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;return t=e.dispose()&&t,this.numOfNodes--,t}},{key:"prune",value:function(e){var t=!0;if(e.isInScene());else if(e.isAncestorInScene());else{for(var r=0;r<e.nodes.length;++r)t=this.dispose(e.nodes[r])&&t;this.sceneGraphRoot.add(e.sceneNode)}return t}},{key:"displayNextLevel",value:function(){var e=this;return new Promise(function(t,r){var n=[],o=[];e.nodesInScene.map(function(t){var r=e.expand(t);n.push(r),r.then(function(){t.nodes.map(function(e){e.loadTile(),o.push(e.getReady())})})}),Promise.all(n).then(function(){0===o.length?r(new Error("OSGTree::displayNextLevel")):Promise.all(o).then(function(){var r=[];e.nodesInScene.map(function(e){e.nodes.map(function(e){e.addToScene()}),r.push.apply(r,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e.nodes)),e.removeFromScene()}),e.nodesInScene=r,t()})})})}},{key:"traverse",value:function(e,t,r,n){var o=!0;o=o&&t(e,r,n);for(var i=0;i<e.nodes.length;++i)o=o&&this.traverse(e.nodes[i],t,r,n);return o}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=u(r(9)),i=u(r(21)),a=u(r(6)),s=r(0),l=u(r(1));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,r){var n=r.position,o=r.scale,u=r.resolution,c=r.rootFile,h=r.basepath,f=r.showBbox,d=r.globalCenter,p=r.globalScale,v=r.forest,y=r.maxLevel,m=r.minLevel;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default,a.default,{position:n,scale:o,resolution:u}));return g.name="OSGEntity",g.rootFile=c,g.basepath=h,g.showBbox=f,g._globalCenter=d,g._globalScale=p,g._tree=null,g._forest=v,g._maxLevel=y,g._minLevel=m,g._treeNode=new s.Object3D,g._treeNode.add(new s.AxesHelper(1e3)),g.sceneNode.add(g._treeNode),g.sceneNode.applyMatrix(function(){var e=l.default.getLocalSystemOnEarthSurface(u,n.lng,n.lat,o),t=new s.Matrix4;t.makeBasis(e.lng,e.lat,e.alt),t.setPosition(e.origin);var r=o/l.default.EARTH_RADIUS;return t.scale(new s.Vector3(r,r,r)),t}()),g}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"startImport",value:function(){var e=this;return Promise.resolve().then(function(){return e._tree=new i.default({root:e.rootFile,basepath:e.basepath,sceneGraphRoot:e._treeNode,showBbox:e.showBbox,globalCenter:e._globalCenter,globalScale:e._globalScale,maxLevel:e._maxLevel,minLevel:e._minLevel}),e._forest.add(e._tree),e._tree})}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(12)),i=l(r(11)),a=l(r(22)),s=l(r(10));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){var r=e.parent,n=e.isMobile,o=e.dataSeeds;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,a.default));s.name="OSGLayer";var l={FOREST_CAPACITY:n?140:400,MAX_DOWNLOAD_CONCURRENCY:n?3:8,MIN_AREA:n?.6:.5,MAX_LEVEL:n?10:14,allowWorker:!1,trees:[],CACHE_CAPACITY:n?160:450,name:"OSGLayer Forest"};return s.forest=new i.default(l),s.trees=[],o.map(function(e){e.forest=s.forest,e.maxLevel=l.MAX_LEVEL,e.minLevel=0,s.add(e).then(function(e){s.trees.push(e)})}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"add",value:function(e){return new a.default(this,e).startImport()}},{key:"remove",value:function(){}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e);var t=Object.assign({},e,{noCache:!0});this.forest.sceneUpdated(t);var r=new s.default(function(e,t){return t.key-e.key}),n=new s.default(function(e,t){return t.key-e.key});for(this.forest.apply(function(e){var t=e.root.ssArea,o={tree:e,node:e.root};r.enqueue(t,o),n.enqueue(t,o)});!r.isEmpty();){c(r.dequeue().value.node)}for(;!n.isEmpty();)for(var o=n.dequeue(),i=o.value.tree,a=o.value.node.nodes,l=0;l<a.length;l++){var u=a[l];c(u),n.enqueue(u.ssArea,{tree:i,node:u})}function c(e){e.setVisibility(e.visible),e.displayByload()}}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=(n=i)&&n.__esModule?n:{default:n},s=r(5),l=r(0);var u=function(e){function t(e){var r=e.earthEntity,n=e.scale;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r)),i=new l.SphereBufferGeometry(1.00505*n,512,512);return o.material=new s.AtmosphereSelfShaderMaterial,o.mesh=new l.Mesh(i,o.material),o.mesh.name="Atmosphere mesh",o.sceneNode.name="Atmosphere Class",o.sceneNode.add(o.mesh),o.height=0,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){return this.sceneNode.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh=null,!0}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t){var r=t.key,n=t.value,o=t.weight,i=void 0===o?100:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._key=r,this._value=n,this._weight=i}return n(e,[{key:"destruct",value:function(){this._key=void 0,this._value=void 0,this._weight=0}},{key:"weight",get:function(){return this._weight}},{key:"value",get:function(){return this._value}},{key:"valid",get:function(){return!0}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(25),a=(n=i)&&n.__esModule?n:{default:n};var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){this._value.dispose(),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this._value&&this._value.image}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadUVMap=void 0;var n=r(0),o=null;t.loadUVMap=function(){var e;return o||(e=new n.TextureLoader,o=new Promise(function(t,r){e.load("../../../public/img/UV_Grid_Sm.jpg",function(e){e.wrapS=e.wrapT=n.RepeatWrapping,t(e)},void 0,function(e){r(e)})})),o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=(n=i)&&n.__esModule?n:{default:n};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"getBlueMarbleCNImageUrl",value:function(e,t,r){return"https://cdn-china.altizure.cn/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getBlueMarbleImageUrl",value:function(e,t,r){return"https://cdn-inter.altizure.com/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getOSMImageUrl",value:function(e,t,r){return"http://"+["a","b","c"][(e+r+t)%3]+".tile.openstreetmap.org/"+e+"/"+t+"/"+r+".png"}},{key:"getBingImageUrl",value:function(e,t,r){var n,o=t,i=r,s=a.default.numerationSystemFrom10(2,o),l=a.default.numerationSystemFrom10(2,i),u=s.length-l.length;if(u>0)for(n=0;n<u;n++)l="0"+l;else if(u<0)for(u=-u,n=0;n<u;n++)s="0"+s;var c="";for(n=0;n<l.length;n++){c+=l[n]+s[n]}var h=a.default.numerationSystemChange(2,4,c);if(h.length<e)for(u=e-h.length,n=0;n<u;n++)h="0"+h;return"//ecn.t"+(e+r+t)%8+".tiles.virtualearth.net/tiles/h"+h+".jpeg?g=1239&mkt=en-us"}},{key:"getCartoImageUrl",value:function(e,t,r){return"//cartodb-basemaps-c.global.ssl.fastly.net/light_all/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleCNImageUrl",value:function(e,t,r){return"http://mt"+["0","1","2","3"][(e+r+t)%4]+".google.cn/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGaodeImageUrl",value:function(e,t,r){return"https://wprd0"+["1","2","3","4"][(e+r+t)%4]+".is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x="+t+"&y="+r+"&z="+e}},{key:"getTencentImageUrl",value:function(e,t,r){var n=["0","1","2","3"][(e+r+t)%4],o=t,i=Math.pow(2,e)-1-r;return"http://p"+n+".map.gtimg.com/sateTiles/"+e+"/"+Math.floor(o/16)+"/"+Math.floor(i/16)+"/"+o+"_"+i+".jpg?version=117"}},{key:"getOpenCycleImageUrl",value:function(e,t,r){return"https://"+["a","b","c"][(e+r+t)%3]+".tile.opencyclemap.org/cycle/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleMoonImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/"+e+"/"+t+"/"+r+".jpg"}},{key:"getHiriseMarsVisibleImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://gmaps-bkup.uahirise.org/mars/visible/"+e+"/"+t+"/"+(r=Math.pow(2,e)-1-r)+".jpg"}},{key:"getNasaMarsTrekImageUrl",value:function(e,t,r){return"https://trektiles.jpl.nasa.gov/trektiles/Mars/EQ/Mars_Viking_MDIM21_ClrMosaic_global_232m/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".png"}},{key:"getNasaMoonTrekImageUrl",value:function(e,t,r){return"https://moontrek.jpl.nasa.gov/trektiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".jpg"}},{key:"getEsriLunarImageUrl",value:function(e,t,r){return"https://crossorigin.me/https://webgis2.wr.usgs.gov/Lunar_Global_GIS/ESRI.ArcGIS.ADF.Web.DataSources.ArcGISServer.TileHandler.ashx?tile=c2d7c76d558f4dfb8ffde861c9229b2e&level="+e+"&column="+t+"&row="+r}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var a=function(){function e(t){var r=this,n=t.parent,i=t.name,a=t.sharedOptions,s=a.sceneGraphRoot,l=a.camera,u=a.debug,c=void 0!==u&&u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=n,this.name=i,this.sceneGraphRoot=s,this.camera=l,this.debug=c,this.lifeState="empty",this._is404=!1,this.needsPrune=!1,this.shapeHolder=new o.Object3D,this.contentHolder=new o.Object3D,this.decoHolder=new o.Object3D,this.shapeHolder.add(this.contentHolder),this.shapeHolder.add(this.decoHolder),this.content=void 0,this.nodes=[],this.contentLoaded=new Promise(function(e,t){r._onContentLoadCompleted=e,r._onContentLoadFailed=t}),this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}return n(e,[{key:"download",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="download is not implemented",console.warn(t),e.abrupt("return",Promise.reject(new Error(t)));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="cook not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="defaultCooked not implemented",console.warn(t),e.abrupt("return",Promise.reject(new Error(t)));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){console.warn("digest not implemented")}},{key:"_updateVisibility",value:function(){console.error("_updateVisibility is not implemented.")}},{key:"_updateScreenArea",value:function(){console.error("_updateScreenArea is not implemented.")}},{key:"destruct",value:function(){return this.debug&&console.log("destruct",JSON.stringify(this.info)),this.isInScene&&this._removeFromSceneGraph(),this.shapeHolder.remove(this.contentHolder),this.shapeHolder.remove(this.decoHolder),this.contentHolder.remove(this.content),this.content=void 0,this.parent=void 0,this.name=void 0,this.lifeState="expired",this.sceneGraphRoot=void 0,this.nodes=void 0,this._visible=!0,this._isPlaceHolder=!1,!0}},{key:"onContentLoaded",value:function(e){var t=!0;return this.content?(console.warn("trying to assign content to a loaded tile",this,e),t=!1):(this.content=e,this.contentHolder.add(this.content),this.debug&&console.log("onload",JSON.stringify(this.info)),this.lifeState="loaded",this._onContentLoadCompleted(e)),t}},{key:"cameraChanged",value:function(){this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}},{key:"displayByload",value:function(){this.debug&&console.log("displayByload",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.loaded&&!this.isInScene&&(e=this._addToSceneAsync()&&e):e=this._replaceParentAttempt()&&e,e):(console.error("not loaded but display attempt"),e=!1)}},{key:"displayByPrune",value:function(){this.debug&&console.log("displayByPrune",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.isInScene?e=!0:this.loaded?(this._addToSceneGraph(),e=!0):e=!1:!function(e){var t=e;for(;null!==t.parent;)t=t.parent;return t.loaded}(this)?e=!1:!function(e){var t=e.parent;for(;null!==t;){if(t.isInScene)return t;t=t.parent}return}(this)?this.isInScene?e=!0:(this.loaded?this._addToSceneGraph():console.error("node is not loaded but descendants in scene"),e=!0):e=!1,e):e=!1}},{key:"_replaceParentAttempt",value:function(){var e=!1;if("loaded"!==this.lifeState)return console.error("not loaded but display atttempt"),e=!1;if(this.isRoot)console.warn("unreachable");else if(this.siblingsLoaded&&this.parent.isInScene){var t=this.parent.nodes;this.parent._removeFromSceneGraph();for(var r=0;r<t.length;r++)t[r]._addToSceneAsync();e=!0}return e}},{key:"_addToSceneAsync",value:function(){return this._addToSceneGraph(),this._beReplacedAttempt(),!0}},{key:"_beReplacedAttempt",value:function(e){var t=!0;if(!this.loaded)return console.error("not loaded but display atttempt"),t=!1;if(!this.isInScene)return console.error("not in scene but be replaced atttempt"),t=!1;if(0===this.nodes.length)t=!1;else if(this.nodes.length>0){if(this.childrenLoaded){this._removeFromSceneGraph();for(var r=0;r<this.nodes.length;r++)this.nodes[r]._addToSceneAsync();t=!0}}else console.error("node with unexpected number of children",this),t=!1;return t}},{key:"_addToSceneGraph",value:function(){var e=this.debug,t=!0;return"loaded"!==this.lifeState?(console.warn(JSON.stringify(this.info)+", content undefined, cannot add to scene"),t=!1):this.isInScene?(console.warn("Twice adding to scene attempt",this.info),t=!1):(this.sceneGraphRoot.add(this.shapeHolder),e&&console.log("add to scene",this.info)),t}},{key:"_removeFromSceneGraph",value:function(){var e=!0;return this.isInScene&&this.content?(this.sceneGraphRoot.remove(this.shapeHolder),this.debug&&console.log("remove from scene",this.info),e):(console.warn("_removeFromSceneGraph fail",this),e=!1)}},{key:"setVisibility",value:function(e){console.warn("deprecated")}},{key:"resourceKey",get:function(){console.error("resourceKey undefined")}},{key:"expandable",get:function(){return!this.is404}},{key:"info",get:function(){return{name:this.name}}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isPlaceHolder",get:function(){return this._isPlaceHolder},set:function(e){this._isPlaceHolder=e}},{key:"is404",get:function(){return this.loaded&&this._is404},set:function(e){e&&(this.isPlaceHolder=!0),this._is404=e}},{key:"visible",get:function(){return this.visibilityNeedsUpdate&&(this._visible=this._updateVisibility(),this.visibilityNeedsUpdate=!1),this._visible}},{key:"loaded",get:function(){return"loaded"===this.lifeState}},{key:"expired",get:function(){return"expired"===this.lifeState}},{key:"screenArea",get:function(){return this.screenAreaNeedsUpdate&&(this._screenArea=this._updateScreenArea()),this._screenArea}},{key:"isInScene",get:function(){return!(null===this.shapeHolder.parent||void 0===this.shapeHolder.parent)}},{key:"siblingsLoaded",get:function(){for(var e=this.parent.nodes,t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}},{key:"childrenLoaded",get:function(){var e=this.nodes;if(e.length>0){for(var t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}return!1}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(29),a=(n=i)&&n.__esModule?n:{default:n};var s=function(e){function t(e){var r=e.parent,n=e.x,o=e.y,i=e.level,a=e.name,s=void 0===a?i+" "+n+" "+o:a,l=e.sharedOptions,u=l.sceneGraphRoot,c=l.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,name:s,sharedOptions:{sceneGraphRoot:u,debug:c}}));return h._level=i,h._x=n,h._y=o,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){return this._level=void 0,this._x=void 0,this._y=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"level",get:function(){return this._level}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=c(r(30)),a=c(r(1)),s=c(r(28)),l=r(27),u=c(r(26));function c(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var f=function(e){function t(e){var r=e.parent,n=e.name,o=e.x,i=e.y,a=e.level,s=e.sharedOptions,l=s.sceneGraphRoot,u=s.debug,c=s.earthGrid,h=s.treeMaterial,f=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(s,["sceneGraphRoot","debug","earthGrid","treeMaterial"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,name:n,x:o,y:i,level:a,sharedOptions:{sceneGraphRoot:l,debug:u}}));return d._earthGrid=c,d._treeMaterial=h,d.earthUniforms=f,d.__geometry=void 0,d._material=void 0,d._color=16777215,d.__vertices=[],d.style={map:void 0,color:16777215,level:a,x:o,y:i},d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"download",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.useTexture?this._downloadTexture():(0,l.loadUVMap)());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=h(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new u.default({key:this.resourceKey,value:t,weight:1}),e.abrupt("return",Promise.resolve(r));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",(0,l.loadUVMap)().then(function(e){var r=new u.default({key:t.resourceKey,value:e,weight:1});return Promise.resolve(r)}).catch(function(e){console.warn(e);var r=new Uint8Array(3);r[0]=0,r[1]=10,r[40]=40;var n=new o.DataTexture(r,1,1,o.RGBFormat);n.needsUpdate=!0;var i=new u.default({key:t.resourceKey,value:n,weight:1});return Promise.resolve(i)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){return this.style.map=e.value,new o.Mesh(this.geometry,this.material)}},{key:"_updateVisibility",value:function(){var e=this;return this.grids.length<=0?(this.color=255,!1):this.grids.map(function(t){var r=t.col,n=t.row;return e.earthGrid.visibility(r,n)}).reduce(function(e,t){return t||e},!1)}},{key:"_updateScreenArea",value:function(){var e=this;if(this.grids.length<=0){var t=this.__standaloneVertices;if(!this.earthGrid.standaloneInFrustum(t))return 0;var r=this.earthGrid.standaloneScreenArea(t);return r>3.9&&(r=1+r/this.level,this.color=65280),r}var n=this.grids.map(function(t){var r=t.col,n=t.row;return e.earthGrid.screenSpaceArea(r,n)}).reduce(function(e,t){return e+t},0);return this.color=n<1e-4?6710886:16777215,n}},{key:"destruct",value:function(){var e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this);return this.__geometry&&this.__geometry.dispose(),this._material&&this._material.dispose(),e}},{key:"dispose",value:function(){console.warn("deprecated.")}},{key:"_downloadTexture",value:function(){var e,t=this.resourceKey;return e=t,new Promise(function(t,r){var n=new o.TextureLoader;n.crossOrigin="",n.load(e,function(e){t(e)},function(e){},function(e){r(new Error("not found"))})})}},{key:"resourceKey",get:function(){var e=this.planet,t="";return void 0===e||"earth"===e?t="China"===this.countryName?this.level<=8?s.default.getBlueMarbleCNImageUrl(this.level,this.x,this.y):s.default.getGoogleCNImageUrl(this.level,this.x,this.y):this.level<=8?s.default.getBlueMarbleImageUrl(this.level,this.x,this.y):s.default.getGoogleImageUrl(this.level,this.x,this.y):"lunar"===e?t=s.default.getNasaMoonTrekImageUrl(this.level,this.x,this.y):"mars"===e&&(t=s.default.getNasaMarsTrekImageUrl(this.level,this.x,this.y)),Object.defineProperty(this,"resourceKey",{value:t,writable:!1,configurable:!0}),this.resourceKey}},{key:"info",get:function(){return Object.defineProperty(this,"info",{value:{level:this.level,x:this.x,y:this.y},writable:!1,configurable:!0}),this.info}},{key:"geometry",get:function(){var e=this.resolution,t=this.scale,r=void 0;if(this.level>e)r=a.default.getTileCartesianGeometryOnEarthSurface(this.level,this.x,this.y,t,1,e);else{var n=Math.pow(2,e)/Math.pow(2,this.level);isNaN(n)&&console.warn(this,e,this.level),r=a.default.getTileCartesianGeometryByGrid(this.level,this.x,this.y,t,n)}return this.__geometry=r,Object.defineProperty(this,"geometry",{value:r,writable:!1,configurable:!0}),this.geometry}},{key:"material",get:function(){return this._material||(this._material=this._treeMaterial.generateTileMaterial(this)),this._material}},{key:"color",set:function(e){e.isColor?this._color=e.clone():this._color=new o.Color(e),this._material&&this._material.color&&(this._material.color=this._color,this._material.needsUpdate=!0)},get:function(){return this._color}},{key:"scale",get:function(){return this.earthUniforms.scale}},{key:"resolution",get:function(){return this.earthUniforms.resolution}},{key:"useColor",get:function(){return this.earthUniforms.useColor}},{key:"planet",get:function(){return this.earthUniforms.planet}},{key:"useTexture",get:function(){return this.earthUniforms.useTexture}},{key:"maxAnisotropy",get:function(){return this.earthUniforms.maxAnisotropy}},{key:"fullScene",get:function(){return this.earthUniforms.fullScene}},{key:"countryName",get:function(){return this.earthUniforms.countryName}},{key:"earthGrid",get:function(){return this._earthGrid}},{key:"grids",get:function(){var e=[];if(this.resolution>=this.level)for(var t=Math.pow(2,this.resolution-this.level),r=0;r<t;r++)for(var n=0;n<t;n++)e.push({col:r+this.x*t,row:n+this.y*t});return Object.defineProperty(this,"grids",{value:e,writable:!1,configurable:!0}),this.grids}},{key:"__standaloneVertices",get:function(){var e=this.resolution,t=this.scale,r=[];return this.level>e?r=a.default.getTileCartesianEnvelopOnEarthSurface(this.level,this.x,this.y,t,e):console.warn("Try to build stand alone vertices",this.level,e),Object.defineProperty(this,"__standaloneVertices",{value:r,writable:!1,configurable:!0}),this.__standaloneVertices}}]),t}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"polygonIntersectArea",value:function(e,t){var r=!1,n=0,o=0,i=0,a=5e4,s=a/2;return function(e,t){r&&console.log("a",e,"b",t);var s=e.length,u=t.length,c=[],h=s+1;for(;h--;)c[h]=null;var v=[];h=u+1;for(;h--;)v[h]=null;var A=new function(e,t){this.min=e,this.max=t}(new l(1/0,1/0),new l(-1/0,-1/0));if(s<3||u<3)return 0;f(e,A),f(t,A),r&&console.log("bbox",A);var _=A.max.x-A.min.x;o=a/_;var b=A.max.y-A.min.y,w=o*(i=a/b);r&&console.log("rngx",_,"rngy",b,"ascale",w);y(e,c,0,A),y(t,v,2,A),r&&console.log("ipa",c,"ipb",v);for(var x=0;x<s;++x)for(var O=0;O<u;++O)if(p(c[x].rx,v[O].rx)&&p(c[x].ry,v[O].ry)){var S=-d(c[x].ip,v[O].ip,v[O+1].ip),k=d(c[x+1].ip,v[O].ip,v[O+1].ip),E=S<0;if(E===k<0){var T=d(v[O].ip,c[x].ip,c[x+1].ip),P=-d(v[O+1].ip,c[x].ip,c[x+1].ip);T<0==P<0&&(E?m(c[x],c[x+1],v[O],v[O+1],S,k,T,P):m(v[O],v[O+1],c[x],c[x+1],T,P,S,k))}}return g(c,s,v,u),g(v,u,c,s),n/w}(e,t);function l(e,t){this.x=e,this.y=t}function u(e,t){this.mn=e,this.mx=t}function c(){this.x=0,this.y=0}function h(){this.ip=null,this.rx=null,this.ry=null,this.in=0}function f(e,t){for(var r=e.length;r--;)t.min.x=Math.min(t.min.x,e[r].x),t.min.y=Math.min(t.min.y,e[r].y),t.max.x=Math.max(t.max.x,e[r].x),t.max.y=Math.max(t.max.y,e[r].y)}function d(e,t,r){return t.x*r.y-t.y*r.x+e.x*(t.y-r.y)+e.y*(r.x-t.x)}function p(e,t){return e.mn<t.mx&&t.mn<e.mx}function v(e,t,r,o,i){n+=i*(r-e)*(o+t)/2}function y(e,t,r,n){for(var a=e.length,l=a;l--;)t[l]=new h,t[l].ip=new c,t[l].ip.x=-8&Math.floor((e[l].x-n.min.x)*o-s)|r|1&l,t[l].ip.y=-8&Math.floor((e[l].y-n.min.y)*i-s)|r;for(t[0].ip.y+=1&a,t[a]=t[0],l=a;l--;)t[l].rx=t[l].ip.x<t[l+1].ip.x?new u(t[l].ip.x,t[l+1].ip.x):new u(t[l+1].ip.x,t[l].ip.x),t[l].ry=t[l].ip.y<t[l+1].ip.y?new u(t[l].ip.y,t[l+1].ip.y):new u(t[l+1].ip.y,t[l].ip.y),t[l].in=0}function m(e,t,r,n,o,i,a,s){var l=o/(o+i),u=a/(a+s);v(Math.floor(e.ip.x+l*(t.ip.x-e.ip.x)),Math.floor(e.ip.y+l*(t.ip.y-e.ip.y)),t.ip.x,t.ip.y,1),v(n.ip.x,n.ip.y,Math.floor(r.ip.x+u*(n.ip.x-r.ip.x)),Math.floor(r.ip.y+u*(n.ip.y-r.ip.y)),1),++e.in,--r.in}function g(e,t,r,n){for(var o=0,i=n,a=e[0].ip;i--;)if(r[i].rx.mn<a.x&&a.x<r[i].rx.mx){var s=d(a,r[i].ip,r[i+1].ip)>0;o+=s!==r[i].ip.x<r[i+1].ip.x?0:s?-1:1}for(var l=0;l<t;++l)0!==o&&v(e[l].ip.x,e[l].ip.y,e[l+1].ip.x,e[l+1].ip.y,o),o+=e[l].in}}},{key:"testPolygonIntersectArea",value:function(){function t(e){for(var t=[],r=0;r<e.length;r++)t[r]={x:e[r][0],y:e[r][1]};return t}function r(r,n){r=t(r),n=t(n),console.log("polygons intersect area",e.polygonIntersectArea(r,n),e.polygonIntersectArea(r,r))}r([[2,3],[2,3],[2,3],[2,4],[3,3],[2,3],[2,3]],[[1,1],[1,4],[4,4],[4,1],[1,1]]),r([[1,7],[4,7],[4,6],[2,6],[2,3],[4,3],[4,2],[1,2]],[[3,1],[5,1],[5,4],[3,4],[3,5],[6,5],[6,0],[3,0]]),r([[1,1],[1,2],[2,1],[2,2]],[[0,0],[0,4],[4,4],[4,0]]),r([[0,0],[3,0],[3,2],[1,2],[1,1],[2,1],[2,3],[0,3]],[[0,0],[0,4],[4,4],[4,0]]),r([[0,0],[1,0],[0,1]],[[0,0],[0,1],[1,1],[1,0]]),r([[1,3],[2,3],[2,0],[1,0]],[[0,1],[3,1],[3,2],[0,2]]),r([[0,0],[0,2],[2,2],[2,0]],[[1,1],[3,1],[3,3],[1,3]]),r([[0,0],[0,4],[4,4],[4,0]],[[1,1],[1,2],[2,2],[2,1]])}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=s(r(1)),a=s(r(32));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var r=t.resolution,n=t.scale,o=t.sceneGraphRoot;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r&&n&&o?(this.name="EarthGrid",this._resolution=r,this._scale=n,this._sceneGraphRoot=o,this._needsUpdate=!1,this._gridVertices=this._constructGridVertices(),this._normals=this._constructBlockNormals(),this._centroids=this._constructBlockCentroids(),this.cameraChanged=!1,this._visibility=[],this._screenSpaceArea=new Float64Array(this.size*this.size),this.__instance=void 0,this.__vertices=void 0,this.__normals=void 0,this.debug=!1,this.__earthToScreen=void 0,this.__frustumInEarth=void 0,this.__camPositionInEarth=void 0):console.error("EarthGrid constructor",arguments)}return n(e,[{key:"destruct",value:function(){this._gridVertices=void 0,this._normals=void 0,this._centroids=void 0,this._screenSpaceArea=void 0,this.__instance&&(this.__normals&&(this.grid.remove(this.__normals),this.__normals.geometry.dispose(),this.__normals.material.dispose()),this.__vertices&&(this.grid.remove(this.__vertices),this.__vertices.geometry.dispose(),this.__vertices.material.dispose()))}},{key:"vertex",value:function(e,t){var r=this.resolution,n=3*(e+t*(Math.pow(2,r)+1)),i=this._gridVertices;return new o.Vector3(i[n],i[n+1],i[n+2])}},{key:"block",value:function(e,t){return[this.vertex(e,t),this.vertex(e,t+1),this.vertex(e+1,t+1),this.vertex(e+1,t)]}},{key:"normal",value:function(e,t){return this._normals[e+t*this.size].clone()}},{key:"centroid",value:function(e,t){return this._centroids[e+t*this.size].clone()}},{key:"isFrontFacing",value:function(e,t,r){var n=r.cameraDirection,o=r.visualize,i=this.normal(e,t).dot(n);if(o){var a=this.size,s=this.__normals.geometry.attributes.color.array,l=3*(e+t*a)*2,u=(i+1)/2;if(Math.abs(u-.5)<.05){for(var c=0;c<6;c++)s[l+c]=0;s[l]=1,s[l+3]=1}else for(var h=0;h<6;h++)s[l+h]=u}return i<0}},{key:"isInFrustum",value:function(e,t,r){var n=r.frustumInEarth,i=r.visualize,a=this.block(e,t),s=new o.Sphere;s.center=this.centroid(e,t).clone(),s.radius=s.center.clone().distanceTo(a[0]);var l=n.intersectsSphere(s);if(i){var u=this.size,c=this.__normals.geometry.attributes.color.array,h=3*(e+t*u)*2;l&&(c[h+1]=1,c[h+4]=1)}return l}},{key:"visibility",value:function(e,t){return this._visibility[e+t*this.size]}},{key:"screenSpaceArea",value:function(e,t){return this._screenSpaceArea[e+t*this.size]}},{key:"update",value:function(e){var t=e.camera,r=e.force,n=void 0!==r&&r,o=e.visualize,i=void 0!==o&&o;return(this.needsUpdate||n)&&(this.updateVisibility({camera:t,visualize:i}),this.udpateScreenSpaceAreas({camera:t,visualize:i}),this.__camera=t),this.needsUpdate=!1,!0}},{key:"_constructGridVertices",value:function(){for(var e=this.scale,t=this.resolution,r=i.default.EQUATOR/2,n=2*r/Math.pow(2,t),o=Math.pow(2,t)+1,a=new Float64Array(o*o*3),s=0;s<o;s++)for(var l=0;l<o;l++){var u=s*n-r,c=r-l*n,h=i.default.webMercatorToDegreeGeographic(u,c);h[0]=Math.min(Math.max(-180,h[0]),180);var f=i.default.geographicToEarthSurface(t,h[0],h[1],e);(isNaN(f.x)||isNaN(f.y)||isNaN(f.z))&&console.warn(s,l,u,c,h,f);var d=3*(s+l*o);a[d]=f.x,a[d+1]=f.y,a[d+2]=f.z}return a}},{key:"_constructBlockNormals",value:function(){for(var e=this.size,t=[],r=0;r<e;r++)for(var n=0;n<e;n++){var o=this.block(n,r),i=o[2].clone().sub(o[1]).cross(o[0].clone().sub(o[1])).normalize();t.push(i)}return t}},{key:"_constructBlockCentroids",value:function(){for(var e,t,r,n,o,i,a,s=this.size,l=[],u=0;u<s;u++)for(var c=0;c<s;c++){var h=this.block(c,u);l.push((void 0,void 0,n=void 0,void 0,void 0,void 0,void 0,t=(e=h)[0].distanceTo(e[3]),r=e[1].distanceTo(e[2]),n=e[0].clone().lerp(e[3],.5),o=e[1].clone().lerp(e[2],.5),i=n.distanceTo(o),a=i*(Math.sqrt(2*t*t+2*r*r)-2*t)/(2*(r-t)),n.lerp(o,a/i)))}return l}},{key:"updateVisibility",value:function(e){var t=e.camera,r=e.visualize,n=this.size,i=new o.Vector3;t.getWorldDirection(i);var a=(new o.Matrix4).getInverse(this.sceneGraphRoot.matrixWorld);i.transformDirection(a);var s=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld),l=(new o.Frustum).setFromMatrix((new o.Matrix4).multiplyMatrices(t.projectionMatrix,s));this.__frustumInEarth=l;for(var u=0;u<n;u++)for(var c=0;c<n;c++)this._visibility[u+c*n]=this.isFrontFacing(u,c,{cameraDirection:i,visualize:r})&&this.isInFrustum(u,c,{frustumInEarth:l,visualize:r});r&&(this.__normals.geometry.attributes.color.needsUpdate=!0)}},{key:"udpateScreenSpaceAreas",value:function(e){var t=e.camera;console.time("screenArea");var r=this.size,n=(new o.Matrix4).getInverse(this.sceneGraphRoot.matrixWorld).clone().multiply(t.matrixWorld);this.__camPositionInEarth=t.position.clone().applyMatrix4(n);var i=(new o.Matrix4).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse).multiply(this.sceneGraphRoot.matrixWorld);this.__earthToScreen=i;for(var a=0;a<r;a++)for(var s=0;s<r;s++)this._screenSpaceArea[a+s*r]=this.visibility(a,s)?this.standaloneScreenArea(this.block(a,s),i):0;return console.timeEnd("screenArea"),!0}},{key:"isOnPlane",value:function(e){var t={front:!1,back:!1};return e.forEach(function(e){if(e.z>=1)t.back=!0;else{if(!(e.z<1&&e.z>0))return!1;t.front=!0}}),t.front&&t.back}},{key:"_blockRetriver",value:function(e,t,r){var n=this.size;return[o(e,t),o(e,t+1),o(e+1,t+1),o(e+1,t)];function o(e,t){var o=3*(e+t*n);return[r[o],r[o+1],r[o+2]]}}},{key:"standaloneScreenArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.__earthToScreen;if(!t)return console.error("no earthToScreen"),0;if(this.standaloneCloseToPlane(e))return 4;var r=e.map(function(e){return e.clone().applyMatrix4(t)});if(this.isOnPlane(r))return 4;var n=a.default.polygonIntersectArea([{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],r);return Math.max(0,n)}},{key:"standaloneInFrustum",value:function(e){var t=new o.Sphere;return t.center=e[0].clone().add(e[1]).add(e[2]).add(e[3]).multiplyScalar(.25),t.radius=t.center.distanceTo(e[0]),this.__frustumInEarth.intersectsSphere(t)}},{key:"standaloneCloseToPlane",value:function(e){var t=e[0].clone().add(e[1]).add(e[2]).add(e[3]).multiplyScalar(.25),r=t.distanceToSquared(e[0]);return this.__camPositionInEarth.clone().distanceToSquared(t)<r}},{key:"needsUpdate",get:function(){return this._needsUpdate},set:function(e){this._needsUpdate=e}},{key:"resolution",get:function(){return this._resolution}},{key:"scale",get:function(){return this._scale}},{key:"sceneGraphRoot",get:function(){return this._sceneGraphRoot}},{key:"debug",set:function(e){this.instance.visible=!!e}},{key:"size",get:function(){return Object.defineProperty(this,"size",{value:Math.pow(2,this._resolution),writable:!1,configurable:!0}),this.size}},{key:"instance",get:function(){var e=new o.Object3D;e.name="EarthGrid";var t=new o.BufferGeometry;t.addAttribute("position",new o.BufferAttribute(Float32Array.from(this._gridVertices),3));var r=new o.PointsMaterial({color:16777215*Math.random(),size:.01}),n=new o.Points(t,r);this.__vertices=n,e.add(n);for(var i=this.size,a=new o.BufferGeometry,s=[],l=[],u=0;u<i;u++)for(var c=0;c<i;c++){var h=this.centroid(c,u),f=this.normal(c,u);s.push(h.x,h.y,h.z,h.x+.05*f.x,h.y+.05*f.y,h.z+.05*f.z),l.push(f.x,f.y,f.z,f.x,f.y,f.z)}a.addAttribute("position",new o.Float32BufferAttribute(s,3)),a.addAttribute("color",new o.Float32BufferAttribute(l,3));var d=new o.LineBasicMaterial({color:16777215,vertexColors:o.VertexColors}),p=new o.LineSegments(a,d);return this.__normals=p,e.add(p),this.__instance=e,Object.defineProperty(this,"instance",{value:e,writable:!1,configurable:!0}),this.instance}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=this,t=null,r=[];this.add=function(n,o,i,a,s,l){if(n)return r.push([n,o,i,a,s,l]),void(1===r.length&&function n(o){t=setTimeout(function(){o=e.add(),r.length&&n(o)},o||0)}(l));var u=r.shift();return u?(u[0].call(u[1],u[2],u[3],u[4]),u[5]):0},this.clear=function(){clearTimeout(t),r=[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=a(r(34)),i=a(r(8));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,r){var n=r.name,i=r.sceneGraphRoot,a=r.eventHandlers,s=void 0===a?{}:a,l=r.maxLevel,u=r.minLevel,c=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=n,this.Node=t,this.sceneGraphRoot=i,this.eventHandlers=s,this.maxLevel=l,this.minLevel=u,this.debug=c,this.root=null,this.numOfNodes=0,this.eventQueue=new o.default,this.sharedOptions={sceneGraphRoot:i,debug:c,onError:s.onError,eventQueue:this.eventQueue},this.flags={modelInitialized:!1}}return n(e,[{key:"destruct",value:function(){var e=!0;return e=e&&this.dispose(this.root),this.root=null,this._onContentDisposed(),this.tile_retriever&&(console.warn("deprecated"),e=e&&this.tile_retriever.destruct(),this.tile_retriever=null),e}},{key:"expand",value:function(e){return console.error("expand is not implemented"),!1}},{key:"dispose",value:function(e){var t=this.debug;if(void 0===e||null===e)return!0;var r=!0;void 0===e.nodes&&console.warn("inspect",e.info);for(var n=0;n<e.nodes.length;n++)r=this.dispose(e.nodes[n])&&r;return t&&console.log("delete",JSON.stringify(e.info)),r=e.destruct()&&r,e=void 0,this.numOfNodes--,r}},{key:"prune",value:function(e){if(void 0===e)return console.warn("Trying to prune undefined node"),!1;var t=!0;if(e.isInScene||e.displayByPrune(),e.nodes.length>0){for(var r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;e.nodes=[]}return t}},{key:"traverse",value:function(e,t,r,n){var o=!0;o=o&&t(e,r,n);for(var i=0;i<e.nodes.length;i++)o=o&&this.traverse(e.nodes[i],t,r,n);return o}},{key:"preSceneUpdate",value:function(){this._onCameraChanged()}},{key:"_onCameraChanged",value:function(){return this.root&&this.traverse(this.root,function(e){e.cameraChanged()}),!0}},{key:"_onContentInitialized",value:function(){this.flags.modelInitialized=!0,this.eventHandlers.onContentInitialized&&this.eventHandlers.onContentInitialized()}},{key:"_onContentDisposed",value:function(){this.flags.modelInitialized=!1,this.eventHandlers.onContentDisposed&&this.eventHandlers.onContentDisposed()}},{key:"name",get:function(){return this._name}},{key:"visible",get:function(){},set:function(e){}},{key:"material",get:function(){return Object.defineProperty(this,"material",{value:new i.default({tree:this}),writable:!1,configurable:!0}),console.warn("TreeMaterial is not implemented."),this.material}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(35),s=(n=a)&&n.__esModule?n:{default:n};var l=function(e){function t(e,r){var n=r.sceneGraphRoot,o=r.name,i=void 0===o?"QuadLodTree":o,a=r.eventHandlers,s=r.maxLevel,l=r.minLevel,u=r.debug;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:i,sceneGraphRoot:n,eventHandlers:a,maxLevel:s,minLevel:l,debug:u}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){var t=e.x,r=e.y,n={level:e.level+1,parent:e,sharedOptions:this.sharedOptions};return e.nodes[0]=new this.Node(o({x:2*t,y:2*r},n)),e.nodes[1]=new this.Node(o({x:2*t,y:2*r+1},n)),e.nodes[2]=new this.Node(o({x:2*t+1,y:2*r},n)),e.nodes[3]=new this.Node(o({x:2*t+1,y:2*r+1},n)),this.numOfNodes+=4,!0}return console.warn("unknown expand error"),!1}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=c(r(36)),a=c(r(33)),s=c(r(8)),l=c(r(7)),u=r(5);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e,r){var n=r.sceneGraphRoot,o=r.name,i=void 0===o?"QuadLodTree":o,s=r.eventHandlers,l=r.maxLevel,u=r.minLevel,c=r.debug,h=void 0!==c&&c,f=r.scale,d=r.resolution,p=r.useColor,v=r.planet,y=r.useTexture,m=r.maxAnisotropy,g=r.fullScene,A=r.countryName;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var _=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{sceneGraphRoot:n,name:i,eventHandlers:s,maxLevel:l,minLevel:u,debug:h}));return _.sharedOptions.scale=f,_.sharedOptions.resolution=d,_.sharedOptions.useColor=p,_.sharedOptions.planet=v,_.sharedOptions.useTexture=y,_.sharedOptions.maxAnisotropy=m,_.sharedOptions.fullScene=g,_.sharedOptions.countryName=A,_.sharedOptions.earthGrid=new a.default({resolution:d,scale:f,sceneGraphRoot:_.sceneGraphRoot}),_.sceneGraphRoot.add(_.sharedOptions.earthGrid.instance),_.sharedOptions.treeMaterial=_.material,_.root=new _.Node({parent:null,name:"Earth Tile root",x:0,y:0,level:0,sharedOptions:_.sharedOptions}),_.numOfNodes++,_.style={flatShading:!0},_}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){this.sceneGraphRoot.remove(this.sharedOptions.earthGrid),this.sharedOptions.earthGrid.destruct(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this.sharedOptions.earthGrid&&(console.time("gridUpdate"),this.sharedOptions.earthGrid.update({camera:r,force:!0,visualize:!1}),console.timeEnd("gridUpdate")),!0}},{key:"material",get:function(){var e=this.sharedOptions.useTexture?u.GroundSelfShaderMaterial:l.default;return Object.defineProperty(this,"material",{value:new s.default({tree:this,Type:e}),writable:!1,configurable:!0}),this.material}}]),t}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=f(r(9)),s=f(r(37)),l=f(r(31)),u=f(r(1)),c=r(5),h=f(r(24));function f(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,r){var n=r.name,o=void 0===n?"EarthEntity":n,a=r.forest,s=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(r,["name","forest"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:o}));return l.sceneNode.name=o+" sceneNode",l.earthTreeOptions=s,l._scale=s.scale,l._resolution=s.resolution,l._useTexture=s.useTexture,l._maxAnisotropy=s.maxAnisotropy,l.northCap=null,l.southCap=null,l.atmosphere=null,l._treeNode=new i.Object3D,l._treeNode.name="_treeNode",l.sceneNode.add(l._treeNode),l._tree=null,l._forest=a,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){var e=!0;return this._tree&&(e=this._tree.destruct()&&e,this._tree=null),this.sceneNode.remove(this._treeNode),e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"startImport",value:function(){this._tree=new s.default(l.default,n({sceneGraphRoot:this._treeNode,name:"Earth Tree"},this.earthTreeOptions));var e=this;return this._forest&&this._forest.add(e._tree),this.initUI().then(function(){return e.initOptionalItems()}).then(function(){return Promise.resolve(e)})}},{key:"initUI",value:function(){var e=this,t={radius:e._scale,polar:"north",imageUrl:"north"},r={radius:e._scale,polar:"south",imageUrl:"south"};return n(t).then(function(t){return t.name="northCap",e.northCap=t,e.sceneNode.add(t),n(r)}).then(function(t){return t.name="southCap",e.southCap=t,e.sceneNode.add(t),Promise.resolve()}).then(function(){return e._useTexture&&(e.atmosphere=new h.default({earthEntity:e,scale:e._scale})),Promise.resolve()}).catch(function(e){return console.warn("EarthEntity initUI error:",e),Promise.resolve()});function n(t){for(var r=t.radius,n=t.polar,o=t.imageUrl,a="north"===n,s=e._resolution,l=Math.pow(2,s),h=u.default.EQUATOR/2,f=-h,d=a?h:-h,p=a?r:-r,v=void 0,y=(h-f)/l,m=new Float32Array(9*l),g=new Float32Array(6*l),A=0;A<l;A++){m[9*A]=0,m[9*A+1]=p,m[9*A+2]=0,g[6*A]=.5,g[6*A+1]=.5;var _=a?A:(A+1)%l,b=S(f+y*_,d);m[9*A+3]=b.x,m[9*A+4]=b.y,m[9*A+5]=b.z,g[6*A+2]=.5+.5*Math.cos(2*Math.PI*_/l),g[6*A+3]=.5+.5*Math.sin(2*Math.PI*_/l);var w=a?(A+1)%l:A,x=S(f+y*w,d);m[9*A+6]=x.x,m[9*A+7]=x.y,m[9*A+8]=x.z,g[6*A+4]=.5+.5*Math.cos(2*Math.PI*w/l),g[6*A+5]=.5+.5*Math.sin(2*Math.PI*w/l)}var O=new i.BufferGeometry;return O.addAttribute("position",new i.BufferAttribute(m,3)),O.addAttribute("uv",new i.BufferAttribute(g,2)),function(t){return(r=t,new Promise(function(e,t){var n=null;n="north"===r?"data:image/jpeg;base64,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":"data:image/jpeg;base64,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";var o=new Image;o.src=n,o.onload=function(){var t=new i.Texture(o);t.needsUpdate=!0,e(t)}})).then(function(t){return v=t,e._maxAnisotropy&&(v.anisotropy=e._maxAnisotropy),Promise.resolve(v)});var r}(o).then(function(t){var r=void 0;if(e._useTexture)r=new c.GroundSelfShaderMaterial({map:t});else{var n=new Uint8Array(3);n[0]=0,n[1]=10,n[40]=40;var o=new i.DataTexture(n,1,1,i.RGBFormat);o.needsUpdate=!0,r=new c.GroundSelfShaderMaterial({map:o})}var a=new i.Mesh(O,r);return Promise.resolve(a)}).catch(function(e){console.warn("Loading logo failed.",e);var t=new i.Mesh(O);return Promise.resolve(t)});function S(e,t){var n=u.default.webMercatorToDegreeGeographic(e,t);return u.default.geographicToCartesianCoord(n[0],n[1],r)}}}},{key:"initOptionalItems",value:function(){var e=this,t=[];if(this.renderItems&&this.renderItems.orbitRing){var r=new Promise(function(t,r){for(var n=new i.Object3D,o=1.1*e._scale,a=Math.PI/180,s=new i.LineBasicMaterial({linewidth:.5,color:7329264,transparent:!0,opacity:.4}),l=new i.Geometry,u=0;u<360;u++){var c=o*Math.cos(a*u),h=o*Math.sin(a*u);l.vertices.push(new i.Vector3(.985*c,0,.985*h)),l.vertices.push(new i.Vector3(c,0,h)),u%30==0?(l.vertices.push(new i.Vector3(.935*c,0,.935*h)),l.vertices.push(new i.Vector3(c,0,h)),l.vertices.push(new i.Vector3(.935*c,0,.935*h)),l.vertices.push(new i.Vector3(c,0,h))):u%5==0&&(l.vertices.push(new i.Vector3(.965*c,0,.965*h)),l.vertices.push(new i.Vector3(c,0,h)),l.vertices.push(new i.Vector3(.965*c,0,.965*h)),l.vertices.push(new i.Vector3(c,0,h)))}var f=new i.LineSegments(l,s),d=new i.LineSegments(l,s);d.rotation.z=Math.PI/2,n.add(f),n.add(d),e._items.add(n),t()});t.push(r)}return Promise.all(t)}},{key:"treeNode",get:function(){return this._treeNode}}]),t}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=[],t=0;this.getLength=function(){return e.length-t},this.isEmpty=function(){return 0===e.length},this.enqueue=function(t){e.push(t)},this.dequeue=function(){if(0!==e.length){var r=e[t];return 2*++t>=e.length&&(e=e.slice(t),t=0),r}},this.peek=function(){return e.length>0?e[t]:void 0},this.clear=function(){e=[],t=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(39),a=(n=i)&&n.__esModule?n:{default:n},s=r(3);function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var u=function(){function e(t){var r=t.capacity,n=t.debug,o=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capacity=r,this.debug=o,this._size=0,this.waitQueue=new a.default,this._taskMap=new Map}return o(e,[{key:"destruct",value:function(){return this.waitQueue.clear(),this.waitQueue=null,this._capacity=0,this._size=0,this._taskMap.clear(),this._taskMap=null,!0}},{key:"clear",value:function(){this.waitQueue.clear(),this._size=0,this._taskMap.clear()}},{key:"abortPending",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[];!this.waitQueue.isEmpty();)r=this.waitQueue.dequeue(),n=r.reject(new Error("[Dock] abortPending")),t.push(n);return e.abrupt("return",Promise.all(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){console.error("Dock.add",e)}),r=this.capacity-this.size}}},{key:"act",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.resolve,o=t.reject,e.abrupt("return",(0,s.timedPromise)(r(),12e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return o(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=e.resourceKey,n=null;if(this._taskMap.has(r)){var o=this._taskMap.get(r);o.tiles.add(e),n=o.task}else{var i=new Set;i.add(e);var a=new Promise(function(e,n){t.waitQueue.enqueue({func:l,resolve:function(n){return t._taskMap.delete(r),e(n)},reject:function(e){return t._taskMap.delete(r),n(e)}})});n=a;var s={task:a,tiles:i};this._taskMap.set(r,s),this.fill()}return n;function l(){var e=null,n=t._taskMap.get(r).tiles;return n.forEach(function(t){t.expired||(e=t)}),n.clear(),null===e?Promise.reject(new Error("[Dock] No active node")):t._downloadTask(e)}}},{key:"_downloadTask",value:function(e,t){return e.download()}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){this.size=0,this.limit=e,this._keymap={}}o.prototype.put=function(e,t){var r={key:e,value:t};if(this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},o.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},o.prototype.get=function(e,t){var r=this._keymap[e];if(void 0!==r)return r===this.tail?t?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,t?r:r.value)},o.prototype.find=function(e){return this._keymap[e]},o.prototype.set=function(e,t){var r,n=this.get(e,!0);return n?(r=n.value,n.value=t):(r=this.put(e,t))&&(r=r.value),r},o.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},o.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?o.prototype.keys=function(){return Object.keys(this._keymap)}:o.prototype.keys=function(){var e=[];for(var t in this._keymap)e.push(t);return e},o.prototype.forEach=function(e,t,r){var o;if(!0===t?(r=!0,t=void 0):"object"!==(void 0===t?"undefined":n(t))&&(t=this),r)for(o=this.tail;o;)e.call(t,o.key,o.value,this),o=o.older;else for(o=this.head;o;)e.call(t,o.key,o.value,this),o=o.newer},o.prototype.toJSON=function(){for(var e=[],t=this.head;t;)e.push({key:t.key.toJSON(),value:t.value.toJSON()}),t=t.newer;return e},o.prototype.toString=function(){for(var e="",t=this.head;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},a=r(41),s=(n=a)&&n.__esModule?n:{default:n};var l=function(e){function t(e){var r=e.capacity,n=e.debug,o=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return i.capacity=r,i.debug=o,i._stat={hit:0,miss:0},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destruct",value:function(){this.clear(),this.capacity=0}},{key:"clear",value:function(){var e=!0;return(e=this.removeAll()&&e)||console.warn("ForestNodeCache clear failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"getTile",value:function(e){var t=e.resourceKey,r=this.get(t);if(void 0===r)this._stat.miss++;else{if(!r.valid)return console.error("ForestNodeCache provides invalid mesh",r),this.remove(t),void r.destruct();this._stat.hit++}return r}},{key:"putTile",value:function(e,t){if(t.valid){var r=e.resourceKey;return!this.get(r)&&(this.put(r,t),!0)}return console.warn("[ForestNodeCache] receives invalid tile."),!1}},{key:"shift",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shift",this).call(this);return e.value.destruct(),e}},{key:"removeAll",value:function(){for(var e=this.capacity+1;this.head&&e>=0;)this.shift(),e--;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeAll",this).call(this),e>=0||(console.warn("cache removeAll error"),!1)}},{key:"_validateMesh",value:function(e){console.warn("deprecated.")}},{key:"stat",get:function(){return this._stat}},{key:"info",get:function(){return{stat:this.stat,size:this.size}}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(19)),i=s(r(42)),a=s(r(40));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var r=t.cacheCapacity,n=t.dockCapacity,s=t.allowWorker,l=t.debug,u=void 0!==l&&l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var c=function(e){var t=o.default.detectIE(),r=!!t&&t<=11;r&&console.warn("You are using an old IE browser. Upgrade to IE 12 or later to get best viewing experience.");return!r&&window.Worker&&e}(s);this.debug=u,this.cache=new i.default({capacity:r,debug:u}),this.dock=new a.default({capacity:n,useWorker:c}),this.status="working"}return n(e,[{key:"destruct",value:function(){this.status="destructing";var e=!0;return e=this.dock.destruct()&&e,(e=this.cache.destruct()&&e)||console.warn("ForestNodeRetriever destruct failed."),this.status="destructed",e}},{key:"abortPending",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dock.abortPending());case 1:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(){return t.apply(this,arguments)}}()},{key:"clear",value:function(){var e=!0;return e=this.dock.clear()&&e,(e=this.cache.clear()&&e)||console.warn("ForestNodeRetriever clear failed."),e}},{key:"request",value:function(e){if("working"!==this.status)return console.warn("ForestNodeRetriever destructing",e.info,"request failed"),!1;var t=this,r=this.cache.getTile(e);return r?Promise.resolve(r):this.dock.queue(e).then(function(t){return e.cook(t)}).catch(function(t){return e.expired?Promise.resolve(void 0):"[Dock] abortPending"===t.message?Promise.reject(t):"not found"===t.message?(e.is404=!0,e.defaultCooked()):"timeout"===t.message?Promise.reject(new Error("timeout")):"expired"===t.message?Promise.reject(t):(console.warn("unknown load error",t),Promise.reject(t))}).then(function(r){return void 0!==r&&t.cache.putTile(e,r),Promise.resolve(r)})}},{key:"info",get:function(){return{cache:this.cache.info,dock:this.dock.info}}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.minNode=void 0,this.nodeCount=0,e&&(this.compare=e)};n.prototype.clear=function(){this.minNode=void 0,this.nodeCount=0},n.prototype.decreaseKey=function(e,t){if(void 0===e)throw new Error("Cannot decrease key of non-existent node");if(this.compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key");e.key=t;var r=e.parent;r&&this.compare(e,r)<0&&(i(e,r,this.minNode,this.compare),a(r,this.minNode,this.compare)),this.compare(e,this.minNode)<0&&(this.minNode=e)},n.prototype.delete=function(e){var t=e.parent;t&&(i(e,t,this.minNode,this.compare),a(t,this.minNode,this.compare)),this.minNode=e,this.extractMinimum()},n.prototype.extractMinimum=function(){var e=this.minNode;if(e){if(e.child){var t=e.child;do{t.parent=void 0,t=t.next}while(t!==e.child)}var r;e.next!==e&&(r=e.next),s(e),this.nodeCount--,this.minNode=u(r,e.child,this.compare),r&&(this.minNode=r,this.minNode=function(e,t){var r=[],n=new o(e);for(;n.hasNext();){for(var i=n.next();r[i.degree];){if(t(i,r[i.degree])>0){var a=i;i=r[i.degree],r[i.degree]=a}l(r[i.degree],i,t),r[i.degree]=void 0,i.degree++}r[i.degree]=i}e=void 0;for(var s=0;s<r.length;s++)r[s]&&(r[s].next=r[s],r[s].prev=r[s],e=u(e,r[s],t));return e}(this.minNode,this.compare))}return e},n.prototype.findMinimum=function(){return this.minNode},n.prototype.insert=function(e,t){var r=new function(e,t){this.key=e,this.value=t,this.prev=this,this.next=this,this.degree=0,this.parent=void 0,this.child=void 0,this.isMarked=void 0}(e,t);return this.minNode=u(this.minNode,r,this.compare),this.nodeCount++,r},n.prototype.isEmpty=function(){return void 0===this.minNode},n.prototype.size=function(){return this.isEmpty()?0:function e(t){var r=0;var n=t;do{r++,n.child&&(r+=e(n.child)),n=n.next}while(n!==t);return r}(this.minNode)},n.prototype.union=function(e){this.minNode=u(this.minNode,e.minNode,this.compare),this.nodeCount+=e.nodeCount},n.prototype.compare=function(e,t){return e.key>t.key?1:e.key<t.key?-1:0};var o=function(e){this.items=[];var t=e;do{this.items.push(t),t=t.next}while(e!==t)};function i(e,t,r,n){return t.degree--,e.next===e?t.child=void 0:t.child=e.next,s(e),r=u(r,e,n),e.isMarked=!1,r}function a(e,t,r){var n=e.parent;return n&&(e.isMarked?t=a(n,t=i(e,n,t,r),r):e.isMarked=!0),t}function s(e){var t=e.prev,r=e.next;t.next=r,r.prev=t,e.next=e,e.prev=e}function l(e,t,r){s(e),t.child=u(e,t.child,r),e.parent=t,e.isMarked=!1}function u(e,t,r){if(e||t){if(!e)return t;if(!t)return e;var n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,r(e,t)<0?e:t}}o.prototype.hasNext=function(){return this.items.length>0},o.prototype.next=function(){return this.items.shift()},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=l(r(12)),a=l(r(11)),s=l(r(38));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,r){var o=r.isMobile,i=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(r,["isMobile"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=o?9:14,u=new a.default({FOREST_CAPACITY:o?120:200,CACHE_CAPACITY:o?140:250,MAX_DOWNLOAD_CONCURRENCY:o?3:8,MIN_AREA:o?.6:.4,MAX_LEVEL:l,allowWorker:!1,name:"EarthLayer Forest"}),c=[n({name:"EarthEntity",forest:u,maxLevel:l,minLevel:0},i)],h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.default,{dataSeeds:c}));return h.forest=u,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"destruct",value:function(){var e=!0;return e=this.forest.destruct()&&e,this.forest=null,e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e),this.forest.sceneUpdated(e)}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(e,t){if(void 0!==e){(t=t||{}).handlers=t.handlers||{},t.thresholds=t.thresholds||{},this.domElement=e,this.enabled=!0,this.debug=t.debug||!1,this.rawTouchDebug=!1,this.handlers={tap:t.handlers.tap||null,"double-tap":t.handlers["double-tap"]||null,"drag-start":t.handlers["drag-start"]||null,drag:t.handlers.drag||null,"drag-end":t.handlers["drag-end"]||null,"pinch-start":t.handlers["pinch-start"]||null,pinch:t.handlers.pinch||null,"pinch-end":t.handlers["pinch-end"]||null,"rotate-start":t.handlers["rotate-start"]||null,rotate:t.handlers.rotate||null,"rotate-end":t.handlers["rotate-end"]||null,"twofingersweep-start":t.handlers["twofingersweep-start"]||null,twofingersweep:t.handlers.twofingersweep||null,"twofingersweep-end":t.handlers["twofingersweep-end"]||null},this.thresholds={doubleTapTimeout:void 0===t.thresholds.doubleTapTimeout?500:t.thresholds.doubleTapTimeout,singleTapTimeout:250,holdTapTimeout:600,twoFingerSweepTorlerance:4,twoFingerSweepOffset:void 0===t.thresholds.twoFingerSweepOffset?2:t.thresholds.twoFingerSweepOffset,gestureQueueLength:void 0===t.thresholds.gestureQueueLength?3:t.thresholds.gestureQueueLength,gestureConsistency:void 0===t.thresholds.gestureConsistency?.66:t.thresholds.gestureConsistency},this.thresholds.twoFingerSweepOffset=Math.max(1,this.thresholds.twoFingerSweepOffset),this.thresholds.twoFingerSweepTorlerance=Math.max(1,this.thresholds.twoFingerSweepTorlerance),this.debug&&console.log("Init recognizer",this.handlers,this.thresholds);var r=-1,o=0,i=0,a=null,s=null,l={NONE:-1,TOUCHSTART:0,TOBETAP:1,TOBEDOUBLETAP:2,TAP:3,DOUBLETAP:4,TOBEDRAG:10,DRAGSTART:11,DRAGGING:12,DRAGEND:13,TOBEPINCH:20,PINCHSTART:21,PINCH:22,PINCHEND:22,TOBEROTATE:30,ROTATESTART:31,ROTATE:32,ROTATEEND:33,TOBETWOFINGERSWEEP:40,TWOFINGERSWEEPSTART:41,TWOFINGERSWEEP:42,TWOFINGERSWEEPEND:43,DBLTAPDRAGSTART:51,DBLTAPDRAGGING:52,DBLTAPDRAGEND:53};this.recognizerState=l.NONE,this.recognizerStateQueue=[];var u=this;u.domElement.addEventListener("touchstart",v,!1),this.removeListeners=function(){u.domElement.removeEventListener("touchstart",v,!1)}}else console.error("Invalid domElement");function c(e){u.debug&&e!==u.recognizerState&&console.log("RecognizerState =>",e),u.recognizerState=e}function h(e){for(var t,r={touches:[]},n=0;n<e.touches.length;++n)r.touches.push({identifier:(t=e.touches[n]).identifier,pageX:t.pageX,pageY:t.pageY});return r.type=e.type,r}function f(e){for(;u.recognizerStateQueue.length>=u.thresholds.gestureQueueLength;)u.recognizerStateQueue.shift();u.recognizerStateQueue.push(e),u.debug&&console.log(u.recognizerStateQueue)}function d(){u.recognizerStateQueue=[]}function p(e){if(u.recognizerStateQueue.length!==u.thresholds.gestureQueueLength)return!1;for(var t=0,r=0;r<u.recognizerStateQueue.length;++r)u.recognizerStateQueue[r]===e&&(t+=1);return t/u.thresholds.gestureQueueLength>=u.thresholds.gestureConsistency}function v(e){if(u.debug&&console.log("onTouchStart"),u.rawTouchDebug&&console.log(e),!1!==u.enabled)switch(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.preventDefault(),u.domElement.addEventListener("touchend",m,!1),u.domElement.addEventListener("touchmove",y,!1),u.debug&&console.log(u.recognizerState),r=0,o=Date.now(),a=h(e),e.touches.length){case 1:u.recognizerState===l.TOBETAP?c(l.TOBEDOUBLETAP):c(l.TOUCHSTART);break;case 2:if(u.recognizerState===l.NONE)c(l.TOUCHSTART),d();else if(u.recognizerState===l.DRAGGING){c(l.TOUCHSTART),d();var t={type:"drag-end"};t.touchEvent=e,u.dispatchEvent(t)}}}function y(e){if(u.debug&&console.log("onTouchMove"),u.rawTouchDebug&&console.log(e),!1!==u.enabled){e.preventDefault(),e.stopPropagation(),r+=1;var t=Date.now();if(i>1e3/60)return u.debug&&console.log("skip the events",i),i=0,void(o=t);switch(e.touches.length){case 1:if(u.recognizerState===l.TOUCHSTART){if(f(l.TOBEDRAG),p(l.TOBEDRAG)){c(l.DRAGSTART);var d={type:"drag-start"};d.touchEvent=null===s?a:s,u.dispatchEvent(d)}}else if(u.recognizerState===l.TOBEDOUBLETAP&&(f(l.TOBEDRAG),p(l.TOBEDRAG))){c(l.DBLTAPDRAGSTART);var v={type:"dbltap-drag-start"};v.touchEvent=null===s?a:s,u.dispatchEvent(v)}if(u.recognizerState===l.DRAGSTART||u.recognizerState===l.DRAGGING){c(l.DRAGGING);var y={type:"drag"};y.touchEvent=e,u.dispatchEvent(y)}else if(u.recognizerState===l.DBLTAPDRAGSTART||u.recognizerState===l.DBLTAPDRAGGING){c(l.DBLTAPDRAGGING);var m={type:"dbltap-drag"};m.touchEvent=e,u.dispatchEvent(m)}break;case 2:if(u.recognizerState===l.TOUCHSTART||u.recognizerState===l.TOBEROTATE||u.recognizerState===l.TOBEPINCH||u.recognizerState===l.TOBETWOFINGERSWEEP){for(var g=[new n.Vector2,new n.Vector2],A=[new n.Vector2,new n.Vector2],_=0;_<2;++_)g[_].set(a.touches[_].pageX,a.touches[_].pageY);for(var b=0;b<2;++b)A[b].set(e.touches[b].pageX,e.touches[b].pageY);for(var w=[new n.Vector2,new n.Vector2],x=0;x<2;++x)w[x].subVectors(A[x],g[x]);var O=[new n.Vector2,new n.Vector2];O[0].subVectors(g[1],g[0]),O[1].subVectors(g[0],g[1]);var S=[new n.Vector2,new n.Vector2];S[0].subVectors(A[1],A[0]),S[1].subVectors(A[0],A[1]);var k=O[0].length()*S[0].length(),E=O[0].dot(S[0])/k,T=new n.Vector3(O[0].x,O[0].y,0),P=new n.Vector3(S[0].x,S[0].y,0),M=T.cross(P).z/k,C=Math.atan2(M,E),R=Math.abs(S[0].length()-O[0].length()),L=Math.abs(O[0].length()*C);if(u.debug&&(console.log("last",g,"current",A,"delta",w),console.log("dir-angle",180*C/Math.PI,"scale-delta",R,"rotate-delta",L)),R-L>u.thresholds.twoFingerSweepTorlerance||R>L&&L>u.thresholds.twoFingerSweepTorlerance){for(var j=R;j>u.thresholds.twoFingerSweepTorlerance;)f(l.TOBEPINCH),j-=u.thresholds.twoFingerSweepTorlerance;if(p(l.TOBEPINCH)){c(l.PINCHSTART),a=null===s?a:s;var N={type:"pinch-start",scale:1,rotation:0},I=new n.Vector2;I.addVectors(g[0],g[1]),I.multiplyScalar(.5),N.center={pageX:I.x,pageY:I.y},N.deltaTime=1e3/60,N.touchEvent=a,N.deltaX=0,N.deltaY=0,u.dispatchEvent(N),N.type="pinchrotate-start",u.dispatchEvent(N)}}else if(L-R>u.thresholds.twoFingerSweepTorlerance||R<L&&R>u.thresholds.twoFingerSweepTorlerance){for(var B=L;B>u.thresholds.twoFingerSweepTorlerance;)f(l.TOBEROTATE),B-=u.thresholds.twoFingerSweepTorlerance;if(p(l.TOBEROTATE)){c(l.ROTATESTART);var F={type:"rotate-start",scale:1,rotation:0},z=new n.Vector2;z.addVectors(g[0],g[1]),z.multiplyScalar(.5),F.center={pageX:z.x,pageY:z.y},F.deltaTime=1e3/60,F.touchEvent=a,F.deltaX=0,F.deltaY=0,u.dispatchEvent(F),F.type="pinchrotate-start",u.dispatchEvent(F)}}else if(w[0].y*w[1].y>0&&Math.abs(w[0].y)>u.thresholds.twoFingerSweepOffset&&Math.abs(w[1].y)>u.thresholds.twoFingerSweepOffset){for(var D=.5*(Math.abs(w[0].y)+Math.abs(w[1].y));D>u.thresholds.twoFingerSweepOffset;)f(l.TOBETWOFINGERSWEEP),D-=u.thresholds.twoFingerSweepOffset;if(p(l.TOBETWOFINGERSWEEP)){c(l.TWOFINGERSWEEPSTART);var U={type:"twofingersweep-start",scale:1,rotation:0},G=new n.Vector2;G.addVectors(g[0],g[1]),G.multiplyScalar(.5),U.center={pageX:G.x,pageY:G.y},U.deltaTime=1e3/60,U.touchEvent=a,U.deltaX=0,U.deltaY=0,u.dispatchEvent(U)}}else f(l.TOUCHSTART)}if(u.recognizerState===l.TWOFINGERSWEEPSTART||u.recognizerState===l.TWOFINGERSWEEP){c(l.TWOFINGERSWEEP);for(var V=[new n.Vector2,new n.Vector2],W=0;W<2;++W)V[W].set(e.touches[W].pageX,e.touches[W].pageY);var K={type:"twofingersweep",scale:1,rotation:0},H=new n.Vector2;H.addVectors(V[0],V[1]),H.multiplyScalar(.5),K.center={pageX:H.x,pageY:H.y},K.deltaTime=1e3/60,K.touchEvent=e,K.deltaX=0,K.deltaY=0,u.dispatchEvent(K)}else if(u.recognizerState===l.PINCHSTART||u.recognizerState===l.PINCH){for(var X=[new n.Vector2,new n.Vector2],Q=0;Q<2;++Q)X[Q].set(a.touches[Q].pageX,a.touches[Q].pageY);c(l.PINCH);for(var q=[new n.Vector2,new n.Vector2],Y=0;Y<2;++Y)q[Y].set(e.touches[Y].pageX,e.touches[Y].pageY);var Z={type:"pinch"},J=new n.Vector2;J.subVectors(X[1],X[0]);var $=new n.Vector2;$.subVectors(q[1],q[0]);var ee=J.length(),te=$.length(),re=J.dot($)/(ee*te),ne=new n.Vector3(J.x,J.y,0),oe=new n.Vector3($.x,$.y,0),ie=ne.cross(oe).z/(ee*te);Z.scale=te/ee,Math.abs(ee)<1e-7&&(Z.scale=1),Z.rotation=180*Math.atan2(ie,re)/Math.PI;var ae=new n.Vector2;ae.addVectors(q[0],q[1]),ae.multiplyScalar(.5),Z.center={pageX:ae.x,pageY:ae.y},Z.deltaTime=1e3/60,Z.touchEvent=e,Z.deltaX=0,Z.deltaY=0,u.dispatchEvent(Z),Z.type="pinchrotate",u.dispatchEvent(Z)}else if(u.recognizerState===l.ROTATESTART||u.recognizerState===l.ROTATE){for(var se=[new n.Vector2,new n.Vector2],le=0;le<2;++le)se[le].set(a.touches[le].pageX,a.touches[le].pageY);c(l.ROTATE);for(var ue=[new n.Vector2,new n.Vector2],ce=0;ce<2;++ce)ue[ce].set(e.touches[ce].pageX,e.touches[ce].pageY);var he={type:"rotate"},fe=new n.Vector2;fe.subVectors(se[1],se[0]);var de=new n.Vector2;de.subVectors(ue[1],ue[0]);var pe=fe.length(),ve=de.length(),ye=fe.dot(de)/(pe*ve),me=new n.Vector3(fe.x,fe.y,0),ge=new n.Vector3(de.x,de.y,0),Ae=me.cross(ge).z/(pe*ve);he.scale=ve/pe,Math.abs(pe)<1e-7&&(he.scale=1),he.rotation=180*Math.atan2(Ae,ye)/Math.PI;var _e=new n.Vector2;_e.addVectors(ue[0],ue[1]),_e.multiplyScalar(.5),he.center={pageX:_e.x,pageY:_e.y},he.deltaTime=1e3/60,he.touchEvent=e,he.deltaX=0,he.deltaY=0,u.dispatchEvent(he),he.type="pinchrotate",u.dispatchEvent(he)}break;default:u.debug&&console.log(e)}s=h(e),i=Date.now()-t,u.debug&&console.log("touchMove",o,"ms")}}function m(e){if(u.debug&&console.log("onTouchEnd"),u.rawTouchDebug&&console.log(e),!1!==u.enabled){u.debug&&console.log(r),u.debug&&console.log(u.handlers),u.debug&&console.log(e),u.debug&&console.log(a),u.debug&&console.log(u.recognizerState);var t,n=Date.now();if(u.recognizerState===l.TWOFINGERSWEEP){c(l.NONE),d();var i={type:"twofingersweep-end"};i.touchEvent=s,u.dispatchEvent(i)}else if(u.recognizerState===l.ROTATE){c(l.NONE),d();var h={type:"rotate-end"};h.touchEvent=s,u.dispatchEvent(h),h.type="pinchrotate-end",u.dispatchEvent(h)}if(u.recognizerState===l.PINCH){c(l.NONE),d();var f={type:"pinch-end"};f.touchEvent=s,u.dispatchEvent(f),f.type="pinchrotate-end",u.dispatchEvent(f)}else switch(a.touches.length){case 1:if(0===r){if(n-o>u.thresholds.singleTapTimeout){c(l.NONE),u.debug&&console.log("Cancel a tap because it is hold for too long");break}if(u.recognizerState!==l.TOBEDOUBLETAP)u.debug&&console.log("first Tapping"),c(l.TOBETAP),setTimeout((t=a,function(){if(u.recognizerState===l.TOBETAP){c(l.TAP);var e={type:"tap"};e.touchEvent=t,u.dispatchEvent(e),c(l.NONE)}}),u.thresholds.doubleTapTimeout);else{u.debug&&console.log("second Tapping"),c(l.DOUBLETAP);var p={type:"double-tap"};p.touchEvent=a,u.dispatchEvent(p),c(l.NONE)}}else if(u.recognizerState===l.DRAGGING){c(l.NONE),d();var v={type:"drag-end"};v.touchEvent=e,u.dispatchEvent(v)}else if(u.recognizerState===l.DBLTAPDRAGGING){c(l.NONE),d();var g={type:"dbltap-drag-end"};g.touchEvent=e,u.dispatchEvent(g)}}r=-1,a=null,s=null,u.domElement.removeEventListener("touchend",m,!1),u.domElement.removeEventListener("touchmove",y,!1)}}};(o.prototype=Object.create(n.EventDispatcher.prototype)).constructor=o,o.prototype.destruct=function(){return this.removeListeners(),this.enabled=!1,this.domElement=void 0,this.handlers=void 0,this.thresholds=void 0,this.recognizerStateQueue=void 0,!0},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(13)),i=s(r(1)),a=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){var r=e.camera,n=e.domElement,o=e.control,i=e.scale,a=e.resolution;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:n}));return s._control=o,s.scale=i,s.resolution=a,s.proxy=s._createProxy(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){this._control=void 0,this.proxy&&(this.proxy.geometry.dispose(),this.proxy.material.dispose(),this.proxy=void 0),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"_createProxy",value:function(){var e=i.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution)),t=new a.Mesh(e);return t.matrixAutoUpdate=!1,t}},{key:"earthToCam",get:function(){var e=this._control._pose.matrix;return(new a.Matrix4).getInverse(e)}},{key:"targets",get:function(){return this.proxy.matrix.identity(),this.proxy.applyMatrix(this.earthToCam),this.proxy.updateMatrixWorld(!0),[this.proxy]},set:function(e){console.warn("Not allowed")}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(13),a=(n=i)&&n.__esModule?n:{default:n};var s=function(e){function t(e){var r=e.camera,n=e.layers,o=e.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:o}));return i._layers=n,i.layerName="altizureMesh",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){this._layers=void 0,this.layerName=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"layer",get:function(){return this._layers[this.layerName]},set:function(e){this.layerName=e}},{key:"targets",get:function(){if(!this.layer)return[];for(var e=[],t=0;t<this.layer.children.length;t++){var r=this.layer.children[t].treeNode;r&&e.push(r)}return e},set:function(e){console.warn("Not allowed")}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(14)),i=r(3),a=l(r(15)),s=r(0);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof a.default&&r instanceof a.default&&n instanceof Object&&void 0!==n.start&&void 0!==n.end?(this.src=t,this.dst=r,this.time=n,this._enabled=!1):console.error("EarthCameraPath",t,r,n)}return n(e,[{key:"destruct",value:function(){return this.enabled=!1,this.src.destruct(),this.dst.destruct(),this.time={},!0}},{key:"sync",value:function(e){e instanceof o.default?this.src.value=e.value:e.isMatrix4&&(this.src.matrix=e)}},{key:"destinate",value:function(t,r){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.onFail(new Error("destination changed")),t.isMatrix4)this.dst.matrix=t;else{if(!(t instanceof Object))return Promise.reject(new Error("unknown destination type"));this.dst.value=t}this.duration=r,this.enabled=!0;var n=this;return this.destinated=(0,i.timedPromise)(new Promise(function(e,t){n._onDestinated=e,n._onInterrupted=t}),e.MAX_FLY_DURATION),this.destinated}},{key:"interrupt",value:function(e){this.onFail(e)}},{key:"_interpolateMatirx",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,l=o.orientation,u=r.clone().lerp(i,e),c=n.clone().slerp(l,e).normalize(),h=new s.Vector3(1,1,1),f=(new s.Matrix4).compose(u,c,h),d=new a.default;return d.matrix=f,d}},{key:"_interpolatePose",value:function(e){var t=this.src.value,r=this.dst.value,n={};return["lng","lat","alt","north","tilt","up"].forEach(function(o){n[o]=function(e,t,r){return e*(1-r)+r*t}(t[o],r[o],e)}),new a.default(n)}},{key:"_interpolateSpherical",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,l=o.orientation,u=(new s.Spherical).setFromVector3(r.clone()),c=(new s.Spherical).setFromVector3(i.clone()),h=new s.Spherical((1-e)*u.radius+e*c.radius,(1-e)*u.phi+e*c.phi,(1-e)*u.theta+e*c.theta),f=(new s.Vector3).setFromSpherical(h),d=n.clone().slerp(l,e).normalize(),p=new s.Vector3(1,1,1),v=(new s.Matrix4).compose(f,d,p),y=new a.default;return y.matrix=v,y}},{key:"orbitLeft",value:function(e,t){}},{key:"swirlLeft",value:function(e,t){}},{key:"onComplete",value:function(){this.src.value=this.dst.value,this.enabled=!1,this._onDestinated()}},{key:"_onDestinated",value:function(){}},{key:"onFail",value:function(e){if(this.enabled){var t=this.pose;if(t){var r=t.matrix;this.src.matrix=r,this.dst.matrix=r}this.enabled=!1,this._onInterrupted(e)}}},{key:"_onInterrupted",value:function(){}},{key:"reset",value:function(){this.src.reset(),this.dst.reset(),this.duration=0,this.onFail()}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"focus",get:function(){return new s.Vector3}},{key:"pose",get:function(){if(this.enabled){this.time.current=Date.now();var e=this.time.current-this.time.start,t=e/(this.time.end-this.time.start);return isNaN(t)?(console.error("pose",t),void this.onFail()):(t>1?t=1:t<0?(console.warn(e/1e3+" seconds to start."),t=0):(t=.50005*(Math.sin((t-.5)*Math.PI)+1),t=Math.min(Math.max(t,0),1)),t>=1?(this.onComplete(),this.dst):this._interpolateSpherical(t))}}},{key:"duration",set:function(t){if(t<0||t>e.MAX_FLY_DURATION)console.error("EarthCameraPath.duration",t);else{var r=Date.now();this.time.start=r-1,this.time.current=r,this.time.end=r+t}}}],[{key:"MAX_FLY_DURATION",get:function(){return 3e5}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,o=r.length;n<o;n++)r[n].call(this,e)}}}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(50),a=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e){var r=e.camera,n=e.handlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=o,a=["onCameraChange","onCameraStart","onCameraEnd"];if(!function(){if(!r)return!1;n&&a.forEach(function(e){n&&n[e]&&(i[e]=n[e])});return!0}())return s(o,void 0);return o._camera=r,o._enabled=!0,o._handlers={},a.forEach(function(e){i._handlers["_"+e]=function(t){if(i.dispatchEvent({type:e}),i[e])return i[e](t)}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){}},{key:"triggerChangeEvent",value:function(){this.dispatchEvent({type:"onCameraChange"})}},{key:"camera",get:function(){return this._camera}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(1)),i=s(r(16)),a=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dd=!0,this.scale=1,this.resolution=i.default.resolution,this.rayCaster=new a.Raycaster,this.proxy=this._createProxy(),this.tempCam=new a.PerspectiveCamera(40,1,1e-7,2.5)}return n(e,[{key:"destruct",value:function(){this.proxy&&(this.proxy.geometry.dispose(),this.proxy.material.dispose(),this.proxy=void 0),this.rayCaster=void 0,this.tempCam=void 0}},{key:"intersect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.Vector2(0,0);this.tempCam.matrix.identity(),this.tempCam.applyMatrix(e),this.tempCam.updateMatrixWorld(!0),this.rayCaster.setFromCamera(t,this.tempCam);var r=this.rayCaster.intersectObject(this.proxy,!1);if(r.length>0)return r[0].point}},{key:"_createProxy",value:function(){var e=o.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution));return new a.Mesh(e)}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(3),i=d(r(15)),a=d(r(51)),s=d(r(49)),l=d(r(1)),u=d(r(48)),c=d(r(47)),h=d(r(46)),f=r(0);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v={NONE:0,ORBIT:1,DOLLY:2,SWIRL:3,TOUCH_ORBIT:11,TOUCH_DOLLY:12,TOUCH_SWIRL:13,FLYTO:21},y=f.MOUSE.LEFT,m=f.MOUSE.MIDDLE,g=f.MOUSE.RIGHT,A=function(e){function t(e){var r=e.camera,n=e.openning,a=void 0===n?{}:n,l=e.handlers,d=e.earthNode,y=e.layers,m=e.domElement,g=e.showAnchor,A=void 0===g||g;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var _=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,handlers:l}));_.dd=!0;var b,w,x,O,S=_;return _.earth_scale=1,_.EARTH_RESOLUTION=6,_._pose=new i.default({earth_scale:_.earth_scale,EARTH_RESOLUTION:_.EARTH_RESOLUTION}),_._cameraPath=null,_.earthNode=d,_.layers=y,_.domElement=m,function(){S.preventDefault=S._preventDefault.bind(S),S.onMouseDown=S._onMouseDown.bind(S),S.onMouseMove=S._onMouseMove.bind(S),S.onMouseUp=S._onMouseUp.bind(S);var e=S._onMouseWheel.bind(S),t=(0,o.debounce)(function(e){S._wheelBursting=!1},500);S.onMouseWheel=function(r){r.preventDefault(),e(r),t(r)},S.onDragStart=S._onDragStart.bind(S),S.onDrag=S._onDrag.bind(S),S.onDragEnd=S._onDragEnd.bind(S),S.onTwoFingerStart=S._onTwoFingerStart.bind(S),S.onTwoFinger=S._onTwoFinger.bind(S),S.onTwoFingerEnd=S._onTwoFingerEnd.bind(S)}(),_.gestureRecognizer=new h.default(_.domElement,{debug:!1}),_.orbitSpeed=.1,_.swirlSpeed=12,_.dollySpeed=2.5,_.enabled=!0,_._enabledDamping=!1,_._state=v.NONE,_._orbitStart=new f.Vector2(0,0),_._orbitEnd=new f.Vector2(0,0),_._swirlStart=new f.Vector2(0,0),_._swirlEnd=new f.Vector2(0,0),_._dollyPoint=new f.Vector2(0,0),_._dollyStart=0,_._dollyEnd=0,_._wheelBursting=!1,_._showAnchor=A,_.showContact=!1,_._anchorScaleFactor=1,_._targetCenterFocus=null,_._picker=new u.default({camera:r,layers:y,domElement:m}),_._earthPicker=new c.default({camera:r,domElement:m,control:_,scale:_.earth_scale,resolution:_.EARTH_RESOLUTION}),b=a.poseTo,w=Object.assign({},{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0},b),x=Object.assign({},w,b),O=Date.now(),S._cameraPath=new s.default(new i.default(x),new i.default(x),{start:O-1,current:O,end:O}),S._pose.value=x,S._updateFrustum=(0,o.throttle)(function(){S.__updateFrustum()},30),S._updateNearFar=(0,o.throttle)(function(){S.__updateNearFar()},300),_}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){this.enabled=!1,this._cameraPath&&this._cameraPath.destruct(),this._cameraPath=void 0,this._pose&&this._pose.destruct(),this._pose=void 0,this.gestureRecognizer&&this.gestureRecognizer.destruct(),this.gestureRecognizer=void 0,this._picker&&this._picker.destruct(),this._picker=void 0,this._earthPicker&&this._earthPicker.destruct(),this._earthPicker=void 0,this._updateFrustum&&(this._updateFrustum=void 0),this._updateNearFar&&(this._updateNearFar=void 0),this.earthNode=void 0,this._orbitStart=void 0,this._orbitEnd=void 0,this._swirlStart=void 0,this._swirlEnd=void 0,this._dollyPoint=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"cameraPose",value:function(){return this._pose.value}},{key:"freeze",value:function(){this.enabled=!1}},{key:"unfreeze",value:function(){this.enabled=!0}},{key:"tiltRange",value:function(){console.warn("tiltRange is under construction.")}},{key:"altRange",value:function(e){var t=e.max,r=e.min;return void 0!==r&&(this._pose.minAlt=r),void 0!==t&&(this._pose.maxAlt=t),{max:this._pose.maxAlt,min:this._pose.minAlt}}},{key:"flyToPose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=this;return this.state!==v.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=v.FLYTO),this._putAnchor(),this.cameraPath.destinate(e,t).then(function(){return r._pose.value=r.cameraPath.dst.value,r.state=v.NONE,r.onCameraChange(),Promise.resolve()}).catch(function(e){return r.onCameraChange(),"destination changed"===e.message?(r._pose.matrix=r.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(r._pose.matrix=r.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;return this.state!==v.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=v.FLYTO),this._putAnchor(),r&&r.isVector3?this._targetCenterFocus=r.clone():this._targetCenterFocus=null,this.cameraPath.destinate(e,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n.state=v.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMatNorthUp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new f.Vector3,o=new f.Quaternion,i=new f.Vector3;e.decompose(n,o,i);var a=n.clone(),s=i.clone(),l=n.clone().normalize(),u=new f.Vector3(0,0,-1).applyQuaternion(o.clone()),c=u.clone().cross(l).normalize(),h=c.clone().cross(u).normalize();(new f.Matrix4).makeBasis(c.normalize(),h.normalize(),u.negate().normalize()).decompose(n,o,i);var d=o.clone(),p=(new f.Matrix4).compose(a,d,s);return this.flyToMat(p,t,r)}},{key:"flyToMatWithFocus",value:function(e,t,r){return this._targetCenterFocus=r.clone(),console.log("flyToMatWithFocus",this._targetCenterFocus),this.flyToMat(e,t)}},{key:"breakDamping",value:function(){console.warn("ni")}},{key:"stopFlying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===v.FLYTO){var t=e?new Error("destination changed"):new Error("stopFlying");this.cameraPath.interrupt(t),this.state=v.NONE}}},{key:"restoreView",value:function(){this._targetCenterFocus=null;var e=this._camera,t=e.view,r=this;return t?new Promise(function(n,o){setTimeout(function(){e.setViewOffset(t.fullWidth,t.fullHeight,0,0,t.fullWidth,t.fullHeight),r._handlers._onCameraChange(),n()},1e3)}):Promise.reject(new Error("No view"))}},{key:"update",value:function(){if(!this.cameraPath)return!1;var e=void 0;if(this.state!==v.FLYTO)this._pose.applyDelta(),e=this._pose.matrix;else{var t=this.cameraPath.pose;if(t){var r=t.matrix;this._pose.matrix=r,e=r,this.__updateFrustum()}else e=this._pose.matrix}if(!this.__prevCamToEarth||!e.equals(this.__prevCamToEarth)){try{var n=(new f.Matrix4).getInverse(e,!0)}catch(e){return console.error("no inverse"),!1}if(this.earthNode.setMatrix(n),this._handlers._onCameraChange(),this.__prevCamToEarth?this.__prevCamToEarth.copy(e):this.__prevCamToEarth=e,(this.showContact||this.showAnchor)&&this.earthEntity){var o=(new f.Vector3).setFromMatrixPosition(e),i=this._pose.anchor,a=o.distanceTo(i),s=.002*this._anchorScaleFactor*a,l=this.earthEntity.focusPoint;if(this.showAnchor?(l.position.copy(i),l.scale.set(s,s,s),l.visible=!0):l.visible=!1,this.showContact)this.earthEntity.contactPoint.scale.set(s,s,s)}}return!0}},{key:"_mount",value:function(){this.domElement.addEventListener("contextmenu",this.preventDefault),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mousewheel",this.onMouseWheel),this.domElement.addEventListener("MozMousePixelScroll",this.onMouseWheel),this.gestureRecognizer.addEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.addEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_unmount",value:function(){this.domElement.removeEventListener("contextmenu",this.preventDefault,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.gestureRecognizer.removeEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.removeEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_preventDefault",value:function(e){e.preventDefault()}},{key:"_onMouseDown",value:function(e){if(this.enabled){if(e.preventDefault(),this.stopFlying(!0),e.button===y){if(!this.enabledOrbit)return;this._handleOrbitStart(e.clientX,e.clientY),this.state=v.ORBIT}else if(e.button===m){if(!this.enabledDolly)return;this.state=v.DOLLY}else if(e.button===g){if(!this.enabledSwirl)return;this._handleSwirlStart(e.clientX,e.clientY),this.state=v.SWIRL}this.state!==v.NONE&&(this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mouseup",this.onMouseUp),this.domElement.addEventListener("mouseout",this.onMouseUp),this._handlers._onCameraStart(e))}}},{key:"_onMouseWheel",value:function(e){if(this.enabled&&this.enabledDolly){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?t=this.dollySpeed:t<0&&(t=-this.dollySpeed),this._wheelBursting||(this.stopFlying(!0),this._pose.distanceToAnchor>.1*this.earth_scale?this._putAnchor():this._putAnchor({x:e.clientX,y:e.clientY}),this._wheelBursting=!0),this.dolly(-t)}}},{key:"_onMouseMove",value:function(e){if(this.enabled){e.preventDefault();var t=this.state;if(t===v.ORBIT){if(!this.enabledOrbit)return;this._handleOrbitMove(e.clientX,e.clientY)}else if(t===v.DOLLY){if(!this.enabledDolly)return}else if(t===v.SWIRL){if(!this.enabledSwirl)return;this._handleSwirl(e.clientX,e.clientY)}if(this.showContact&&this.earthEntity){var r={x:e.clientX,y:e.clientY},n=this.pickProjectContactPointInEarth({rawX:r.x,rawY:r.y},"altizureMesh");if(n){var o=this.earthEntity.contactPoint;o.position.copy(n),o.visible=!0}}}}},{key:"_onMouseUp",value:function(e){this.enabled&&(this.state===v.ORBIT?(this.enabledOrbit&&this._handlers._onCameraEnd(e),this.state=v.NONE):this.state===v.DOLLY?(this.enabledDolly&&this._handlers._onCameraEnd(e),this.state=v.NONE):this.state===v.SWIRL&&(this.enabledSwirl&&this._handlers._onCameraEnd(e),this.state=v.NONE),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("mouseout",this.onMouseUp))}},{key:"_onDragStart",value:function(e){if(this.enabledOrbit){this.stopFlying(!0);var t=e.touchEvent,r=t.touches[0].pageX,n=t.touches[0].pageY;this._handleOrbitStart(r,n),this.state=v.ORBIT,this.gestureRecognizer.addEventListener("drag",this.onDrag),this.gestureRecognizer.addEventListener("drag-end",this.onDragEnd),this._handlers._onCameraStart(t)}}},{key:"_onDrag",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this._handleOrbitMove(t.touches[0].pageX,t.touches[0].pageY),this.state=v.ORBIT}}},{key:"_onDragEnd",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this.gestureRecognizer.removeEventListener("drag",this.onDrag),this.gestureRecognizer.removeEventListener("drag-end",this.onDragEnd),this._handlers._onCameraEnd(t),console.log("_onDragEnd"),this.state=v.NONE}}},{key:"_onTwoFingerStart",value:function(e){if(this.enabledSwirl){this.stopFlying(!0);var t=e.center;this._handleSwirlStart(t.pageX,t.pageY),this.state=v.SWIRL;var r=this.__twoTouchPoints(e),n=r.p,o=r.q,i=n.distanceTo(o);isNaN(i)||(this._dollyStart=i),this.gestureRecognizer.addEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.addEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.addEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.addEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraStart(event)}}},{key:"_onTwoFinger",value:function(e){if(this.enabledSwirl){var t=e.center;this._handleSwirl(t.pageX,t.pageY);var r=this.__twoTouchPoints(e),n=r.p,o=r.q,i=n.distanceTo(o);if(!isNaN(i)){if(this._dollyEnd=i,0!==this._dollyStart){var a=(this._dollyEnd-this._dollyStart)/-50;this.dolly(a*this.dollySpeed)}this._dollyStart=this._dollyEnd}this.state=v.SWIRL}}},{key:"_onTwoFingerEnd",value:function(e){if(this._onDragEnd(e),this.enabledSwirl){var t=e.touchEvent;this._dollyStart=this._dollyEnd=0,this.gestureRecognizer.removeEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.removeEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.removeEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.removeEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraEnd(t),console.log("_onTwoFingerEnd"),this.state=v.NONE}}},{key:"_handleOrbitStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._orbitStart.set(e,t)}},{key:"_handleOrbitMove",value:function(e,t){this._orbitEnd.set(e,t);var r=(new f.Vector3).subVectors(this._orbitEnd,this._orbitStart),n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.orbitLeft(r.x/n*this.orbitSpeed),this.orbitUp(r.y/n*this.orbitSpeed),this._orbitStart.copy(this._orbitEnd)}},{key:"_handleSwirlStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._swirlStart.set(e,t)}},{key:"_handleSwirl",value:function(e,t){this._swirlEnd.set(e,t);var r=(new f.Vector3).subVectors(this._swirlEnd,this._swirlStart),n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.swirlLeft(r.x/n*this.swirlSpeed),this.swirlUp(r.y/n*this.swirlSpeed),this._swirlStart.copy(this._swirlEnd)}},{key:"_putAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pose;if(e){var r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");return r||(r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y})),void t.putAnchor(r)}t.putAnchor()}},{key:"__updateNearFar",value:function(){var e=this._camera,t=void 0,r=void 0,n=this._pose.matrix,o=(new f.Vector3).setFromMatrixPosition(n),i=this._pose.anchor,a=o.distanceTo(i),s=o.length();i.length()<.8*this.earth_scale?(t=1e-5,r=s):(t=.01*a,r=s+Math.min(Math.max(10*a,s),2*this.earth_scale)),e.near=t,e.far=r}},{key:"__updateFrustum",value:function(){var e=this._targetCenterFocus;if(e){var t=this._camera,r=this._pose.matrix;if(!t.view)return void console.warn("No view ready.");0;var n=e.clone(),o=(new f.Matrix4).getInverse(r);n.applyMatrix4(o);var i=t.fov,a=t.aspect,s=t.near,l=t.far,u=new f.PerspectiveCamera(i,a,s,l),c=n.project(u);0;var h=(c.x+1)/2*this.domWidth,d=(1-c.y)/2*this.domHeight,p=t.view,v=h-(p.offsetX+p.width/2),y=d-(p.offsetY+p.height/2),m=p.offsetX+v,g=p.offsetY+y;0,t.setViewOffset(p.fullWidth,p.fullHeight,m,g,p.width,p.height)}}},{key:"__twoTouchPoints",value:function(e){var t=e.touchEvent.touches;return{p:new f.Vector2(t[0].pageX,t[0].pageY),q:new f.Vector2(t[1].pageX,t[1].pageY)}}},{key:"orbitLeft",value:function(e){0!==e&&this._pose.orbitLeft(e)}},{key:"orbitUp",value:function(e){0!==e&&this._pose.orbitUp(e)}},{key:"dolly",value:function(e){var t=this;0!==e&&function(){var r=t,n=e/3;r._pose.dolly(n);for(var o=60;o<180;o+=60)setTimeout(function(){r._pose.dolly(n)},o)}()}},{key:"swirlLeft",value:function(e){e&&this._pose.swirlLeft(e)}},{key:"swirlUp",value:function(e){e&&this._pose.swirlUp(e)}},{key:"pickEarthContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=this._earthPicker.pick(t,r);if(n.length>0){var o=this._pose.matrix,i=n[0].point.clone();i.applyMatrix4(o);var a=l.default.earthSurfaceToGeographic(this.EARTH_RESOLUTION,i,this.earth_scale);return{lng:a.lng,lat:a.lat,alt:0}}}},{key:"pickProjectContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"altizureMesh",o=this.pickProjectContactPointInEarth({rawX:t,rawY:r},n);if(o)return l.default.getLngLatAltFromNoneGroundCartesian(this.EARTH_RESOLUTION,o,this.earth_scale)}},{key:"pickProjectContactPointInEarth",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"altizureMesh";this._picker.layerName=n;var o=this._picker.pick(t,r);if(o.length>0){var i=this._pose.matrix,a=o[0].point.clone();return a.applyMatrix4(i),a}}},{key:"mapToWindow",value:function(e,t){return this._picker._NDC_inv(e,t)}},{key:"onCameraChange",value:function(){this._updateNearFar()}},{key:"cameraPath",get:function(){return this._cameraPath}},{key:"pose",get:function(){return this._pose.value},set:function(e){this._pose.value=e,this._handlers._onCameraChange()}},{key:"camToEarth",get:function(){return this._pose.matrix}},{key:"POS",get:function(){return this._pose.POS}},{key:"state",set:function(e){this._state=e},get:function(){return this._state}},{key:"enabled",set:function(e){this._enabled=e,this.enabledOrbit=e,this.enabledDolly=e,this.enalbedSwirl=e,e?this._mount():(this._unmount(),this.state=v.NONE,this.cameraPath.interrupt(new Error("disabled")))},get:function(){return this._enabled}},{key:"enabledOrbit",set:function(e){this._enabledOrbit=e},get:function(){return this._enabledOrbit}},{key:"enabledDolly",set:function(e){this._enabledDolly=e},get:function(){return this._enabledDolly}},{key:"enalbedSwirl",set:function(e){this._enabledSwirl=e}},{key:"enabledSwirl",get:function(){return this._enabledSwirl}},{key:"enableRotate",set:function(e){this.enabledOrbit=e}},{key:"focus",get:function(){return this._pose.value}},{key:"domWidth",get:function(){return this.domElement.clientWidth}},{key:"domHeight",get:function(){return this.domElement.clientHeight}},{key:"showAnchor",get:function(){return this._showAnchor},set:function(e){this._showAnchor=e}}]),t}();t.default=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=r(0),a=f(r(20)),s=f(r(16)),l=f(r(4)),u=f(r(53)),c=f(r(45)),h=r(3);f(r(23));function f(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e){e&&e.HOST&&e.api&&e.api.apiUrl&&e.api.key||console.warn("Altizure authorization is Missing. Altizure services will not be available.");return Object.assign({},{renderItems:{planet:"earth",earthUseTexture:!0,orbitRing:!1,tileBox:!1},develop:!1,control:{doubleTap:!0},camera:{poseTo:{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0}},debug:!1},e)}(r),o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=o;return o._renderItems=n.renderItems,o._type="EarthViewer",window.viewer=o,o.earthNode=new l.default(null),o.earthNode.sceneNode.name="earthNode",function(){a.scene.add(a.earthNode.sceneNode),a._welcomeMesh=new i.Mesh(new i.SphereBufferGeometry(1,32,32),new i.MeshBasicMaterial({wireframe:!0})),a._welcomeMesh.name="welcomeMesh",a.earthNode.sceneNode.add(a._welcomeMesh);var e=a.env.isMobile;return Promise.all([a.countryName.then(function(t){return a.layers.earth=new c.default(a.earthNode,{isMobile:e,renderItems:{orbitRing:a.renderItems.orbitRing},eventHandlers:r.eventHandlers,scale:a.scale,resolution:a.resolution,useColor:!0,planet:a.renderItems.planet,useTexture:!1,maxAnisotropy:a.renderer.capabilities.getMaxAnisotropy(),fullScene:!0,countryName:t}),a.layers.earth.startImport()}).catch(function(e){return console.error("initScene",e),Promise.reject(e)})])}(),a.__updateScene=(0,h.throttle)(a._updateScene,2500),o.openning=function(){return a.control=new u.default({camera:a.camera,openning:{poseTo:n.camera.poseTo},handlers:void 0,earthNode:a.earthNode,layers:a.layers,domElement:a.renderer.domElement,showAnchor:n.develop}),window.addEventListener("resize",function(){a.resize()},!1),n.camera.flyTo?a.control.flyToPose(n.camera.flyTo,n.camera.time):Promise.resolve()}(),o.isInitialized=!0,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){var e=!0;return this.control&&(this.control.destruct(),this.control=void 0),e=this.earthNode.destruct()&&e,this.earthNode=void 0,e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"_addEarthLayer",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.showEarth){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.abrupt("return",Promise.reject(new Error("Hide earth")));case 5:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(){return t.apply(this,arguments)}}()},{key:"animate",value:function(){var e=(new i.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),r=new i.Frustum;r.setFromMatrix(e.clone());var n=(new i.Clock).getElapsedTime(),a={camera:this.camera,pvmatrix:e,frustum:r,viewportSize:this.renderer.getSize(),currentTime:n};this.earthNode&&this.earthNode.animate(a),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"animate",this).call(this)}},{key:"updateScene",value:function(e){this.__updateScene(e)}},{key:"_updateScene",value:function(e){console.log("_updateScene");if(this.isInitialized){0;var t={camera:this.camera};if(!function(e){var t=e.camera;if(isNaN(t.far)||isNaN(t.near))return!1;return!0}(t))return!1;for(var r in this.layers)this.layers[r]&&this.layers[r].sceneUpdated(t)}}},{key:"_updateFrustum",value:function(e){}},{key:"scale",get:function(){return s.default.scale}},{key:"resolution",get:function(){return s.default.resolution}},{key:"renderItems",get:function(){var e=this;return Object.defineProperty(this,"renderItems",{value:{get planet(){return e._renderItems.planet},set planet(e){console.warn("No support")},get earth(){return e.showEarth},set earth(t){e.showEarth=t},get earthUseTexture(){return e.showEarthTexture},set earthUseTexture(t){e.showEarthTexture=t},get orbitRing(){return e.showOrbitRing},set orbitRing(t){e.showOrbitRing=t}},writable:!1,configurable:!0}),this.renderItems}},{key:"showEarth",set:function(e){e!==this.showEarth&&(this._renderItems.earth=e)},get:function(){return this._renderItems.earth}},{key:"showEarthTexture",set:function(e){this.showEarth&&e!==this.showEarthTexture&&(this._renderItems.earthUseTexture=e)},get:function(){return this._renderItems.earthUseTexture}},{key:"showOrbitRing",set:function(e){this.showEarth&&e!==this.showOrbitRing&&(this._renderItems.orbitRing=e)},get:function(){return this._renderItems.orbitRing}}]),t}();t.default=d},function(e,t,r){var n;e.exports=(n=r(2),n.enc.Utf8)},function(e,t,r){var n;e.exports=(n=r(2),r(17),void(n.lib.Cipher||function(e){var t=n,r=t.lib,o=r.Base,i=r.WordArray,a=r.BufferedBlockAlgorithm,s=t.enc,l=(s.Utf8,s.Base64),u=t.algo,c=u.EvpKDF,h=r.Cipher=a.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?x:_}return function(t){return{encrypt:function(r,n,o){return e(n).encrypt(t,r,n,o)},decrypt:function(r,n,o){return e(n).decrypt(t,r,n,o)}}}}()}),f=(r.StreamCipher=h.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),t.mode={}),d=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=f.CBC=function(){var t=d.extend();function r(t,r,n){var o=this._iv;if(o){var i=o;this._iv=e}else var i=this._prevBlock;for(var a=0;a<n;a++)t[r+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize;r.call(this,e,t,o),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=e.slice(t,t+o);n.decryptBlock(e,t),r.call(this,e,t,o),this._prevBlock=i}}),t}(),v=t.pad={},y=v.Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var l=i.create(a,n);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:p,padding:y}),reset:function(){h.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=t.format={},A=g.OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=i.create([1398893684,1701076831]).concat(r).concat(t);else var n=t;return n.toString(l)},parse:function(e){var t=l.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=i.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:n})}},_=r.SerializableCipher=o.extend({cfg:o.extend({format:A}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var o=e.createEncryptor(r,n),i=o.finalize(t),a=o.cfg;return m.create({ciphertext:i,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var o=e.createDecryptor(r,n).finalize(t.ciphertext);return o},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=t.kdf={},w=b.OpenSSL={execute:function(e,t,r,n){n||(n=i.random(8));var o=c.create({keySize:t+r}).compute(e,n),a=i.create(o.words.slice(t),4*r);return o.sigBytes=4*t,m.create({key:o,iv:a,salt:n})}},x=r.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:w}),encrypt:function(e,t,r,n){var o=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=o.iv;var i=_.encrypt.call(this,e,t,o.key,n);return i.mixIn(o),i},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var o=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);n.iv=o.iv;var i=_.decrypt.call(this,e,t,o.key,n);return i}})}()))},function(e,t,r){var n,o,i,a,s,l,u;e.exports=(n=r(2),i=(o=n).lib,a=i.Base,s=o.enc,l=s.Utf8,u=o.algo,void(u.HMAC=a.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=l.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),a=o.words,s=i.words,u=0;u<r;u++)a[u]^=1549556828,s[u]^=909522486;o.sigBytes=i.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();var n=t.finalize(this._oKey.clone().concat(r));return n}})))},function(e,t,r){var n,o,i,a,s,l,u;e.exports=(n=r(2),i=(o=n).lib,a=i.WordArray,s=i.Hasher,l=[],u=o.algo.SHA1=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],u=0;u<80;u++){if(u<16)l[u]=0|e[t+u];else{var c=l[u-3]^l[u-8]^l[u-14]^l[u-16];l[u]=c<<1|c>>>31}var h=(n<<5|n>>>27)+s+l[u];h+=u<20?1518500249+(o&i|~o&a):u<40?1859775393+(o^i^a):u<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=n,n=h}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=s._createHelper(u),o.HmacSHA1=s._createHmacHelper(u),n.SHA1)},function(e,t,r){var n;e.exports=(n=r(2),function(e){var t=n,r=t.lib,o=r.WordArray,i=r.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],l=e[t+1],d=e[t+2],p=e[t+3],v=e[t+4],y=e[t+5],m=e[t+6],g=e[t+7],A=e[t+8],_=e[t+9],b=e[t+10],w=e[t+11],x=e[t+12],O=e[t+13],S=e[t+14],k=e[t+15],E=i[0],T=i[1],P=i[2],M=i[3];T=f(T=f(T=f(T=f(T=h(T=h(T=h(T=h(T=c(T=c(T=c(T=c(T=u(T=u(T=u(T=u(T,P=u(P,M=u(M,E=u(E,T,P,M,a,7,s[0]),T,P,l,12,s[1]),E,T,d,17,s[2]),M,E,p,22,s[3]),P=u(P,M=u(M,E=u(E,T,P,M,v,7,s[4]),T,P,y,12,s[5]),E,T,m,17,s[6]),M,E,g,22,s[7]),P=u(P,M=u(M,E=u(E,T,P,M,A,7,s[8]),T,P,_,12,s[9]),E,T,b,17,s[10]),M,E,w,22,s[11]),P=u(P,M=u(M,E=u(E,T,P,M,x,7,s[12]),T,P,O,12,s[13]),E,T,S,17,s[14]),M,E,k,22,s[15]),P=c(P,M=c(M,E=c(E,T,P,M,l,5,s[16]),T,P,m,9,s[17]),E,T,w,14,s[18]),M,E,a,20,s[19]),P=c(P,M=c(M,E=c(E,T,P,M,y,5,s[20]),T,P,b,9,s[21]),E,T,k,14,s[22]),M,E,v,20,s[23]),P=c(P,M=c(M,E=c(E,T,P,M,_,5,s[24]),T,P,S,9,s[25]),E,T,p,14,s[26]),M,E,A,20,s[27]),P=c(P,M=c(M,E=c(E,T,P,M,O,5,s[28]),T,P,d,9,s[29]),E,T,g,14,s[30]),M,E,x,20,s[31]),P=h(P,M=h(M,E=h(E,T,P,M,y,4,s[32]),T,P,A,11,s[33]),E,T,w,16,s[34]),M,E,S,23,s[35]),P=h(P,M=h(M,E=h(E,T,P,M,l,4,s[36]),T,P,v,11,s[37]),E,T,g,16,s[38]),M,E,b,23,s[39]),P=h(P,M=h(M,E=h(E,T,P,M,O,4,s[40]),T,P,a,11,s[41]),E,T,p,16,s[42]),M,E,m,23,s[43]),P=h(P,M=h(M,E=h(E,T,P,M,_,4,s[44]),T,P,x,11,s[45]),E,T,k,16,s[46]),M,E,d,23,s[47]),P=f(P,M=f(M,E=f(E,T,P,M,a,6,s[48]),T,P,g,10,s[49]),E,T,S,15,s[50]),M,E,y,21,s[51]),P=f(P,M=f(M,E=f(E,T,P,M,x,6,s[52]),T,P,p,10,s[53]),E,T,b,15,s[54]),M,E,l,21,s[55]),P=f(P,M=f(M,E=f(E,T,P,M,A,6,s[56]),T,P,k,10,s[57]),E,T,m,15,s[58]),M,E,O,21,s[59]),P=f(P,M=f(M,E=f(E,T,P,M,v,6,s[60]),T,P,w,10,s[61]),E,T,d,15,s[62]),M,E,_,21,s[63]),i[0]=i[0]+E|0,i[1]=i[1]+T|0,i[2]=i[2]+P|0,i[3]=i[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32;var i=e.floor(n/4294967296),a=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,l=s.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,o,i,a){var s=e+(t&r|~t&n)+o+a;return(s<<i|s>>>32-i)+t}function c(e,t,r,n,o,i,a){var s=e+(t&n|r&~n)+o+a;return(s<<i|s>>>32-i)+t}function h(e,t,r,n,o,i,a){var s=e+(t^r^n)+o+a;return(s<<i|s>>>32-i)+t}function f(e,t,r,n,o,i,a){var s=e+(r^(t|~n))+o+a;return(s<<i|s>>>32-i)+t}t.MD5=i._createHelper(l),t.HmacMD5=i._createHmacHelper(l)}(Math),n.MD5)},function(e,t,r){var n,o,i;e.exports=(n=r(2),i=(o=n).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var l=n.charAt(64);if(l)for(;o.length%4;)o.push(l);return o.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var o=0;o<r.length;o++)n[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,l=r[e.charCodeAt(a)]>>>6-a%4*2;n[o>>>2]|=(s|l)<<24-o%4*8,o++}return i.create(n,o)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var n;e.exports=(n=r(2),r(60),r(59),r(17),r(56),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,o=[],i=[],a=[],s=[],l=[],u=[],c=[],h=[],f=[],d=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,o[r]=p,i[p]=r;var v=e[r],y=e[v],m=e[y],g=257*e[p]^16843008*p;a[r]=g<<24|g>>>8,s[r]=g<<16|g>>>16,l[r]=g<<8|g>>>24,u[r]=g,g=16843009*m^65537*y^257*v^16843008*r,c[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,f[p]=g<<8|g>>>24,d[p]=g,r?(r=v^e[e[e[m^v]]],n^=e[e[n]]):r=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],v=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],a=0;a<n;a++)if(a<r)i[a]=t[a];else{var s=i[a-1];a%r?r>6&&a%r==4&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=p[a/r|0]<<24),i[a]=i[a-r]^s}for(var l=this._invKeySchedule=[],u=0;u<n;u++)a=n-u,s=u%4?i[a]:i[a-4],l[u]=u<4||a<=4?s:c[o[s>>>24]]^h[o[s>>>16&255]]^f[o[s>>>8&255]]^d[o[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,l,u,o)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,h,f,d,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,i,a,s){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],h=e[t+2]^r[2],f=e[t+3]^r[3],d=4,p=1;p<l;p++){var v=n[u>>>24]^o[c>>>16&255]^i[h>>>8&255]^a[255&f]^r[d++],y=n[c>>>24]^o[h>>>16&255]^i[f>>>8&255]^a[255&u]^r[d++],m=n[h>>>24]^o[f>>>16&255]^i[u>>>8&255]^a[255&c]^r[d++],g=n[f>>>24]^o[u>>>16&255]^i[c>>>8&255]^a[255&h]^r[d++];u=v,c=y,h=m,f=g}v=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&f])^r[d++],y=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[f>>>8&255]<<8|s[255&u])^r[d++],m=(s[h>>>24]<<24|s[f>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^r[d++],g=(s[f>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^r[d++],e[t]=v,e[t+1]=y,e[t+2]=m,e[t+3]=g},keySize:8});e.AES=t._createHelper(v)}(),n.AES)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(18)),i=s(r(61)),a=s(r(55));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=t.apiUrl,this.key=t.key,this.altitoken=t.altitoken}return n(e,[{key:"destruct",value:function(){}},{key:"project",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { id name owner { id name } isImported views date versionControl cloudPath { key dataUrl } geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong } modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter }}}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project)}).catch(function(e){return console.error("api:project",e),Promise.reject(e)})}},{key:"my",value:function(e){var t=e&&e.timeout?e.timeout:1e4;return this._request("{my{self{ id name email balance company country joined}\n   projects { edges {node { id name owner {id username name} views date versionControl  cloudPath { key dataUrl }  geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong }  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}}}}}}",t).then(function(e){return Promise.resolve(e.data.data.my)}).catch(function(e){return console.error("api:my",e),Promise.reject(e)})}},{key:"allProjects",value:function(e){var t=e.limit,r=e.timeout?e.timeout:2e4,n="{ allProjects (first: "+t+") { edges { node { id name showLocation visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date  } } } }";return this._request(n,r).then(function(e){for(var t=[],r=e.data.data.allProjects.edges,n=0;n<r.length;n++)t.push(r[n].node);return Promise.resolve(t)}).catch(function(e){return console.error("api:allProjects",e),Promise.reject(e)})}},{key:"getCountryName",value:function(e){var t=(e=e||{}).timeout?e.timeout:1e4;return this._request("{ getGeoIPInfo { countryName } }",t).then(function(e){var t=e.data.data.getGeoIPInfo.countryName;return Promise.resolve(t)}).catch(function(e){return console.warn("api:getGeoIPInfo",e,"set to China"),Promise.resolve("China")})}},{key:"geoNearProjects",value:function(e){var t=e.limit,r=e.center,n=e.span,o=e.timeout?e.timeout:1e4,i=function(e){var t=e[0],r=e[1];t<-180?t=-180:t>180&&(t=180);r<-90?r=-90:r>90&&(r=90);return[t,r]}([r.lng,r.lat]),a="{geoNearProjects(center: "+("{ latitude: "+i[1]+", longitude:"+i[0]+" }")+", span:"+n+", limit: "+t+") {id name visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date }}";return this._request(a,o).then(function(e){var t=e.data.data.geoNearProjects;return Promise.resolve(t)}).catch(function(e){return console.error("api:geoNearProjects",e),Promise.reject(e)})}},{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={key:this.key};this.altitoken&&(n.altitoken=this.altitoken);var i=this;return r--,(0,o.default)({method:"post",url:this.apiUrl,timeout:t,headers:n,data:"query="+e,responseType:"json"}).catch(function(n){return n instanceof Error&&n.message.includes("timeout")&&r>0?i._request(e,2*t,r):Promise.reject(n)})}},{key:"cropMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { \n      cropMask { \n        usage \n        maskBox { minX minY maxX maxY } \n        maskInfos { polyNum width height data } \n      } \n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.cropMask)}).catch(function(e){return console.error("api:cropMask",e),Promise.reject(e)})}},{key:"waterMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'"){\n      waterMask {\n        maskInfos { level alpha wave color polyNum width height data }\n        maskBox { minX minY maxX maxY }\n      }\n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.waterMask)}).catch(function(e){return console.error("api:waterMask",e),Promise.reject(e)})}},{key:"projectMask",value:function(e){var t=e.pid,r=e.usage;return"crop"===r?this.cropMask({pid:t}):"water"===r?this.waterMask({pid:t}):Promise.reject(new Error("Unknown mask usage "+r))}},{key:"solution",value:function(e){var t=e.sid,r=e.timeout?e.timeout:1e4,n='{\n      solution (id: "'+t+'") {\n        id name visibility scene history owner {\n          name\n        }\n      }\n    }';return this._request(n,r).then(function(e){var t=e.data.data.solution;if("string"==typeof t.scene&&t.scene.length>0){var r=i.default.decrypt(decodeURIComponent(t.scene),"altizure-environment").toString(a.default);t.scene=r}else console.warn("scene",t);return Promise.resolve(t)}).catch(function(e){return console.error("api:solution",e),Promise.reject(e)})}},{key:"createProjectSolution",value:function(e){var t=e.name,r=e.timeout?e.timeout:1e4,n='mutation{\n      createProjectSolution(name: "'+t+'"){\n        id name scene history owner {\n          id name\n        }\n      }\n    }';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.createProjectSolution)}).catch(function(e){return console.error("api:createProjectSolution",e),Promise.reject(e)})}},{key:"updateProjectSolution",value:function(e){var t=e.id,r=e.options.data.name,n=i.default.encrypt(e.options.data.scene,"altizure-environment").toString(),o=encodeURIComponent(n),a=void 0!==e.options.preserveScene&&e.options.preserveScene,s=e.timeout?e.timeout:1e4,l='mutation{\n      updateProjectSolution(\n        id: "'+t+'", \n        options: {\n          data: {name: "'+r+'", scene: "'+o+'"}, \n          preserveScene: '+a+"\n        }\n      ){\n        id name scene history owner {\n          id name\n        }\n      }\n    }";return this._request(l,s).then(function(e){return Promise.resolve(e.data.data.updateProjectSolution)}).catch(function(e){return console.error("api:updateProjectSolution",e),Promise.reject(e)})}},{key:"removeProjectSolution",value:function(e){var t=e.id,r=e.timeout?e.timeout:1e4,n='mutation{\n      removeProjectSolution(id: "'+t+'"){\n        id name scene history owner {\n          id name\n        }\n      }\n    }';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.removeProjectSolution)}).catch(function(e){return console.error("api:createProjectSolution",e),Promise.reject(e)})}},{key:"altitoken",set:function(e){this._altitoken=e},get:function(){return this._altitoken}},{key:"key",set:function(e){this._key=e},get:function(){return this._key}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),n.createDiv=function(e,t,r,n){var o=document.createElement("div");return"undefined"!=typeof id&&(o.id=t+"_div"),void 0!==t&&(o.className=t),void 0!==r&&(o.style.cssText=r),void 0!==n&&(o.innerHTML=n),e.appendChild(o),o},n.createMessageDiv=function(e,t,r,o){var i=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),a=n.createDiv(e,"ErrorDiv",i),s=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),l=n.createDiv(a,"ErrorTextDiv",s);return l.innerHTML=t,o&&(l.innerHTML+='<br><br><a href="'+o+'" class="btn-link">Learn More</a>'),a},n.createThree=function(e,t){var r=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];return t&&r.push("background-image: "+t),r=r.join(""),n.createDiv(e,"ThreeDiv",r)},t.default=n},function(e){e.exports={name:"altizure-gl-engine",version:"1.0.0",description:"Altizure webgl engine",main:"./release/altizure-gl-engine.min.js",scripts:{lint:"eslint ./src/",test:"jest --runInBand",release:"rm ./release/* -rf && webpack --config webpack.config.release.js",debug:"rm ./build/* -rf && webpack --config webpack.config.debug.js",build:"npm run debug",doc:"jsdoc -c ./docs/jsdoc.tui.dev.json -r ./src/",prepublishOnly:"yarn && gulp release && npm version patch",postpublish:"git push origin master",push:"git push bitbucket beta && git push github beta && git push gitlab beta"},repository:{type:"git",url:"git+ssh://git@bitbucket.org/jingbo/altizure.gl-engine2.git"},keywords:["altizure","webgl","engine"],author:"Jingbo LIU",license:"ISC",homepage:"https://bitbucket.org/jingbo/altizure.gl-engine2#readme",devDependencies:{"babel-cli":"^6.26.0","babel-core":"^6.26.3","babel-eslint":"^8.2.3","babel-jest":"^22.4.3","babel-loader":"^7.1.5","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-es2015-modules-umd":"^6.24.1","babel-preset-env":"^1.6.1","babel-preset-stage-2":"^6.24.1",eslint:"^4.19.1","eslint-config-standard":"^12.0.0-alpha.0","eslint-plugin-import":"^2.11.0","eslint-plugin-node":"^6.0.1","eslint-plugin-promise":"^3.7.0","eslint-plugin-standard":"^3.1.0",jest:"^22.4.3",jsdoc:"^3.5.5",leakage:"^0.3.0",path:"^0.12.7","regenerator-runtime":"^0.11.1","tui-jsdoc-template":"^1.2.2",webpack:"^4.8.1","webpack-bundle-analyzer":"^2.11.2","webpack-cli":"^2.1.3"},peerDependencies:{},dependencies:{axios:"^0.18.0","crypto-js":"^3.1.9-1",three:"0.91.0","worker-loader":"^2.0.0"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthViewer=t.HyperViewer=t.testfunc3=t.testfunc2=t.testfunc1=void 0;var n=a(r(64)),o=a(r(20)),i=a(r(54));function a(e){return e&&e.__esModule?e:{default:e}}console.log(n.default.description,n.default.version),t.testfunc1=function(e){console.log(e)},t.testfunc2=function(e,t){return e+t},t.testfunc3=function(e){e.forEach(function(e){console.log(e+1)})},t.HyperViewer=o.default,t.EarthViewer=i.default},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=_;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={},y={};y[a]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(C([])));g&&g!==n&&o.call(g,a)&&(y=g);var A=O.prototype=w.prototype=Object.create(y);x.prototype=A.constructor=O,O.constructor=x,O[l]=x.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,O):(e.__proto__=O,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(A),e},c.awrap=function(e){return{__await:e}},S(k.prototype),k.prototype[s]=function(){return this},c.AsyncIterator=k,c.async=function(e,t,r,n){var o=new k(_(e,t,r,n));return c.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},S(A),A[l]="Generator",A[a]=function(){return this},A.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},c.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function _(e,t,r,n){var o=t&&t.prototype instanceof w?t:w,i=Object.create(o.prototype),a=new M(n||[]);return i._invoke=function(e,t,r){var n=h;return function(o,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return R()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=E(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var l=b(e,t,r);if("normal"===l.type){if(n=r.done?p:f,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function w(){}function x(){}function O(){}function S(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function k(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var s=b(e[r],e,n);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&o.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(u).then(function(e){l.value=e,i(l)},a)}a(s.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function E(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,E(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=b(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){r(66),e.exports=r(65)}])});